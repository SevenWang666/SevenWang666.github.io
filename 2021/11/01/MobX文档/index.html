<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>mobx文档 | xincheng</title><meta name="author" content="xincheng"><meta name="copyright" content="xincheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MobX文档资源 mobx中文文档  mobx源码地址  mobx-react-lite英文文档（暂时没有找到完整版的中文版文档）  mobx-react源码地址(下面的README.md里是完整版本的英文文档)  mobx-react-lite源码地址 ​       关于库mobx：提供observable、action、computed等API的库，类比redux。 mobx-react：提">
<meta property="og:type" content="article">
<meta property="og:title" content="mobx文档">
<meta property="og:url" content="http://example.com/2021/11/01/MobX%E6%96%87%E6%A1%A3/index.html">
<meta property="og:site_name" content="xincheng">
<meta property="og:description" content="MobX文档资源 mobx中文文档  mobx源码地址  mobx-react-lite英文文档（暂时没有找到完整版的中文版文档）  mobx-react源码地址(下面的README.md里是完整版本的英文文档)  mobx-react-lite源码地址 ​       关于库mobx：提供observable、action、computed等API的库，类比redux。 mobx-react：提">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1638979193&t=85f0a5750ddf5762669a9bf2aaac970b">
<meta property="article:published_time" content="2021-11-01T00:00:00.000Z">
<meta property="article:modified_time" content="2021-11-08T16:15:04.548Z">
<meta property="article:author" content="xincheng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1638979193&t=85f0a5750ddf5762669a9bf2aaac970b"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/11/01/MobX%E6%96%87%E6%A1%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mobx文档',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-08 16:15:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="xincheng" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1638979193&amp;t=85f0a5750ddf5762669a9bf2aaac970b')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">xincheng</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">mobx文档</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-11-01T00:00:00.000Z" title="Created 2021-11-01 00:00:00">2021-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-11-08T16:15:04.548Z" title="Updated 2021-11-08 16:15:04">2021-11-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">6.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>28min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="mobx文档"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MobX文档"><a href="#MobX文档" class="headerlink" title="MobX文档"></a>MobX文档</h1><h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://cn.mobx.js.org/">mobx中文文档</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mobxjs/mobx">mobx源码地址</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mobx-react.js.org/">mobx-react-lite英文文档（暂时没有找到完整版的中文版文档）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mobxjs/mobx-react">mobx-react源码地址</a>(下面的README.md里是完整版本的英文文档)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mobxjs/mobx-react-lite">mobx-react-lite源码地址</a></p>
<p>​    </p>
</li>
</ol>
<h2 id="关于库"><a href="#关于库" class="headerlink" title="关于库"></a>关于库</h2><p><strong>mobx</strong>：提供observable、action、computed等API的库，类比redux。</p>
<p><strong>mobx-react</strong>：提供Provider、inject、observer、Observer、useObserver、useAsObservableSource、 useLocalStore等API的库。最新版的mobx-react中包括了mobx-react-lite。</p>
<p><strong>mobx-react-lite</strong>：相当于是mobx-react的精简版，不支持Provider、inject，但是用户可以依靠React Context自己实现这两个API的功能。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="MobX简介"><a href="#MobX简介" class="headerlink" title="MobX简介"></a>MobX简介</h3><p>简单、可扩展的状态管理。</p>
<p>安装 <code>yarn add mobx </code></p>
<p>React 绑定库: <code>yarn add mobx-react</code></p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><pre><code> MobX 可以通过 *decorate* 工具在不支持装饰器语法的情况加使用。 尽管如此，多数 MobX 用户更喜欢装饰器语法，因为它更简洁。
</code></pre>
<p>装饰器参考<a target="_blank" rel="noopener" href="https://cn.mobx.js.org/best/decorators.html">https://cn.mobx.js.org/best/decorators.html</a></p>
<h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h3><p>MobX通过透明的函数响应式编程(transparently applying functional reactive programming - TFRP)使得状态管理变得简单和可扩展。MobX背后的哲学很简单:</p>
<p><em>任何源自应用状态的东西都应该自动地获得。</em></p>
<p>其中包括UI、数据序列化、服务器通讯，等等。</p>
<p><img src="https://cn.mobx.js.org/flow.png" alt="MobX unidirectional flow"></p>
<p>React 和 MobX 是一对强力组合。React 通过提供机制把应用状态转换为可渲染组件树并对其进行渲染。而MobX提供机制来存储和更新应用状态供 React 使用。</p>
<p>对于应用开发中的常见问题，React 和 MobX 都提供了最优和独特的解决方案。React 提供了优化UI渲染的机制， 这种机制就是通过使用虚拟DOM来减少昂贵的DOM变化的数量。MobX 提供了优化应用状态与 React 组件同步的机制，这种机制就是使用响应式虚拟依赖状态图表，它只有在真正需要的时候才更新并且永远保持是最新的。</p>
<h3 id="lesson1-MobX要点"><a href="#lesson1-MobX要点" class="headerlink" title="lesson1-MobX要点"></a>lesson1-MobX要点</h3><h4 id="1-定义状态并使其可观察"><a href="#1-定义状态并使其可观察" class="headerlink" title="1. 定义状态并使其可观察"></a>1. 定义状态并使其可观察</h4><p>可以用任何你喜欢的数据结构来存储状态，如对象、数组、类。 循环数据结构、引用，都没有关系。 只要确保所有会随时间流逝而改变的属性打上 <code>mobx</code> 的标记使它们变得可观察即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;observable&#125; <span class="keyword">from</span> <span class="string">&#x27;mobx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> appState = observable(&#123;</span><br><span class="line">    <span class="attr">timer</span>: <span class="number">0</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="2-创建视图以响应状态的变化"><a href="#2-创建视图以响应状态的变化" class="headerlink" title="2. 创建视图以响应状态的变化"></a>2. 创建视图以响应状态的变化</h4><p>我们的 <code>appState</code> 还没有观察到任何的东西。 你可以创建视图，当 <code>appState</code> 中相关数据发生改变时视图会自动更新。 MobX 会以一种最小限度的方式来更新视图。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observer&#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react&quot;</span>;</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerView</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  onReset = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.appState.resetTimer();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onReset&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Seconds passed: &#123;this.props.appState.timer&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TimerView;</span><br></pre></td></tr></table></figure>



<h4 id="3-更改状态"><a href="#3-更改状态" class="headerlink" title="3. 更改状态"></a>3. 更改状态</h4><p>第三件要做的事就是更改状态。 也就是你的应用究竟要做什么。 不像一些其它框架，MobX 不会命令你如何如何去做。 这是最佳实践，但关键要记住一点: <strong>MobX 帮助你以一种简单直观的方式来完成工作</strong>。</p>
<p>下面的代码每秒都会修改你的数据，而当需要的时候UI会自动更新。 无论是在<strong>改变</strong>状态的控制器函数中，还是在应该<strong>更新</strong>的视图中，都没有明确的关系定义。 使用 <code>observable</code> 来装饰你的<strong>状态</strong>和<strong>视图</strong>，这足以让 MobX检测所有关系了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appState.resetTimer = action(<span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    appState.timer = <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(action(<span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    appState.timer += <span class="number">1</span>;</span><br><span class="line">&#125;), <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>只有在严格模式(默认是不启用)下使用 MobX 时才需要 <code>action</code> 包装。 建议使用 action，因为它将帮助你更好地组织应用，并表达出一个函数修改状态的意图。 同时,它还自动应用事务以获得最佳性能。</p>
<h3 id="lesson2-MobX-API-概念"><a href="#lesson2-MobX-API-概念" class="headerlink" title="lesson2-MobX API 概念"></a>lesson2-MobX API 概念</h3><h4 id="Observable-state-可观察的状态"><a href="#Observable-state-可观察的状态" class="headerlink" title="Observable state(可观察的状态)"></a>Observable state(可观察的状态)</h4><p>MobX 为现有的数据结构(如对象，数组和类实例)添加了可观察的功能。 通过使用 <a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/observable-decorator.html">@observable</a> 装饰器(ES.Next)来给你的类属性添加注解就可以简单地完成这一切。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;observable, computed&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> </span>&#123;</span><br><span class="line">  @observable todos = [</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="string">&quot;0&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;任务0&quot;</span>, <span class="attr">finished</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="string">&quot;1&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;任务1&quot;</span>, <span class="attr">finished</span>: <span class="literal">false</span>&#125;</span><br><span class="line">  ];</span><br><span class="line">  @computed <span class="keyword">get</span> <span class="title">unfinishedTodoCount</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.finished).length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Computed-values-计算值"><a href="#Computed-values-计算值" class="headerlink" title="Computed values(计算值)"></a>Computed values(计算值)</h4><p>定义在相关数据发生变化时自动更新的值。如上段代码，当添加了一个新的todo或者某个todo的 <code>finished</code> 属性发生变化时，MobX 会确保 <code>unfinishedTodoCount</code> 自动更新。</p>
<h4 id="Reactions-反应"><a href="#Reactions-反应" class="headerlink" title="Reactions(反应)"></a>Reactions(反应)</h4><p>Reactions 和计算值很像，但它不是产生一个新的值，而是会产生一些副作用，比如打印到控制台、网络请求、递增地更新 React 组件树以修补DOM、等等。</p>
<h5 id="React-组件"><a href="#React-组件" class="headerlink" title="React 组件"></a>React 组件</h5><p>如果你用 React 的话，可以把你的(无状态函数)组件变成响应式组件，方法是在组件上添加 <a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/observable-decorator.html"><code>observer</code></a> 函数/ 装饰器. <code>observer</code>由 <code>mobx-react</code> 包提供的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;observer&#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react&quot;</span>;</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoListView</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;todos, unfinishedTodoCount&#125; = <span class="built_in">this</span>.props.todoList;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;todos.map(todo =&gt; (</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TodoView</span> <span class="attr">todo</span>=<span class="string">&#123;todo&#125;</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Tasks left: &#123;unfinishedTodoCount&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoView = observer(<span class="function">(<span class="params">&#123;todo&#125;</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">checked</span>=<span class="string">&#123;todo.finished&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> todo.finished = !todo.finished&#125;</span></span><br><span class="line"><span class="xml">        /&gt;&#123;todo.title&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> TodoList();</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TodoListView</span> <span class="attr">todoList</span>=<span class="string">&#123;store&#125;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h5 id="自定义-reactions"><a href="#自定义-reactions" class="headerlink" title="自定义 reactions"></a>自定义 reactions</h5><p>使用<a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/autorun.html"><code>autorun</code></a>、<a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/reaction.html"><code>reaction</code></a> 和 <a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/when.html"><code>when</code></a> 函数即可简单的创建自定义 reactions，以满足你的具体场景。</p>
<p>例如，每当 <code>unfinishedTodoCount</code> 的数量发生变化时，下面的 <code>autorun</code> 会打印日志消息:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">autorun(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Tasks left: &quot;</span> + todos.unfinishedTodoCount)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h5 id="MobX-会对什么作出响应"><a href="#MobX-会对什么作出响应" class="headerlink" title="MobX 会对什么作出响应?"></a>MobX 会对什么作出响应?</h5><p><em>MobX 会对在执行跟踪函数期间读取的任何现有的可观察属性做出反应</em>。</p>
<h4 id="Actions-动作"><a href="#Actions-动作" class="headerlink" title="Actions(动作)"></a>Actions(动作)</h4><p>任何应用都有动作。动作是任何用来修改状态的东西。</p>
<p>使用MobX你可以在代码中显式地标记出动作所在的位置。 动作可以有助于更好的组织代码。 建议在任何更改 observable 或者有副作用的函数上使用动作。 结合开发者工具的话，动作还能提供非常有用的调试信息。 注意: 当启用<strong>严格模式</strong>时，需要强制使用 <code>action</code>，参见 <code>enforceActions</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;configure&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许在动作外部修改状态</span></span><br><span class="line">configure(&#123;<span class="attr">enforceActions</span>: <span class="string">&quot;observed&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="enforceActions"><a href="#enforceActions" class="headerlink" title="enforceActions"></a><code>enforceActions</code></h4><p>也被称为“严格模式”。</p>
<p>在严格模式下，不允许在 <a target="_blank" rel="noopener" href="https://cn.mobx.js.org/refguide/action.html"><code>action</code></a> 外更改任何状态。 可接收的值:</p>
<ul>
<li><code>&quot;never&quot;</code> (默认): 可以在任意地方修改状态</li>
<li><code>&quot;observed&quot;</code>: 在某处观察到的所有状态都需要通过动作进行更改。在正式应用中推荐此严格模式。</li>
<li><code>&quot;always&quot;</code>: 状态始终需要通过动作来更新(实际上还包括创建)。</li>
</ul>
<h3 id="lesson3-给组件添加响应式"><a href="#lesson3-给组件添加响应式" class="headerlink" title="lesson3-给组件添加响应式"></a>lesson3-给组件添加响应式</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gijayj5424j30z80u07wh.jpg" alt="image-20200908160328366"></p>
<p>给组件添加响应式有以下三种办法：</p>
<p>😎 <a target="_blank" rel="noopener" href="https://mobx-react.js.org/observer-hoc">observer HOC</a></p>
<p>🤓 <a target="_blank" rel="noopener" href="https://mobx-react.js.org/observer-component">observer component</a></p>
<p>🧐 <a target="_blank" rel="noopener" href="https://mobx-react.js.org/observer-hook">useObserver hook</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Observer, useObserver, observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = observable(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// named function is optional (for debugging purposes)</span></span><br><span class="line"><span class="keyword">const</span> P1 = observer(<span class="function"><span class="keyword">function</span> <span class="title">P1</span>(<span class="params">&#123; person &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P2 = <span class="function">(<span class="params">&#123; person &#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P3 = <span class="function">(<span class="params">&#123; person &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">P1</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">P2</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">P3</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  person.name = <span class="string">&#x27;Jane&#x27;</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>



<h5 id="observer-HOC"><a href="#observer-HOC" class="headerlink" title="observer HOC"></a>observer HOC</h5><p>注意：mobx-react与mobx-react-lite中都有observer，但是后者不支持类组件。</p>
<p>以下是参数，如果组件是函数式组件，可以使用options，类组件则没有。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">observer&lt;P&gt;(baseComponent: React.FC&lt;P&gt;, options?: IObserverOptions): React.FC&lt;P&gt;</span><br><span class="line"></span><br><span class="line">interface IObserverOptions &#123;</span><br><span class="line">    // Pass true to use React.forwardRef over the inner component. It&#x27;s false by the default.</span><br><span class="line">    forwardRef?: boolean</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>observer把组件转换成响应式组件，它可以自动追踪哪个可观察量被使用了以及当值改变的时候自动重新渲染这个组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observer, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Counter = observer&lt;Props&gt;(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> store = useLocalStore(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: props.initialCount,</span><br><span class="line">    <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      store.count += <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;store.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;store.inc&#125;</span>&gt;</span>Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>observer内部使用了React.memo，所以使用的时候我们可以不用自己再封装memo，但值得注意的是，observer内部封装的memo只负责默认的浅比较，因为mobx-react认为，observed组件很少需要基于复杂的props进行更新渲染。以下是mobx-react-lite中的源码部分截图，参考行61-63的注释。</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gircs01emmj30ut0u0e81.jpg" alt="image-20200915151056480" style="zoom:50%;" />



<h5 id="Observer-component"><a href="#Observer-component" class="headerlink" title="Observer component"></a>Observer component</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Observer&gt;&#123;renderFn&#125;&lt;/Observer&gt;</span><br></pre></td></tr></table></figure>

<p>接收一个匿名无参数的函数作为children，并且返回React元素。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observer, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ObservePerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> person = useLocalStore(<span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span> &#125;))</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;person.name&#125; <span class="tag">&lt;<span class="name">i</span>&gt;</span>I will never change my name<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> (person.name = &#x27;Mike&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">          I want to be Mike</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：只能使得它自己的返回组件是响应式的，如果你里面还嵌套了别的组件，那这个里面的组件得靠自己变成响应式~</p>
<p>看下面的例子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObservePerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;() =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">GetStore</span>&gt;</span>&#123;store =&gt; <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;self&quot;</span>&gt;</span>&#123;store.wontSeeChangesToThis&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">GetStore</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面这个例子里，这个className为div就不是响应式，如果想变成响应式，需要再额外添加，比如说像下面这样：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObservePerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">GetStore</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;store =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;store.changesAreSeenAgain&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">GetStore</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="useObserver-hook"><a href="#useObserver-hook" class="headerlink" title="useObserver hook"></a>useObserver hook</h5><p>函数签名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useObserver&lt;T&gt;(fn: () =&gt; T, baseComponentName = &quot;observed&quot;, options?: IUseObserverOptions): T</span><br><span class="line"></span><br><span class="line">interface IUseObserverOptions &#123;</span><br><span class="line">    // optional custom hook that should make a component re-render (or not) upon changes</span><br><span class="line">    useForceUpdate: () =&gt; () =&gt; void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这个自定义hook方法只存在于mobx-react-lite，或者是mobx-react@6。</p>
<p>这个hook方法也可以使组件变得响应式，但是关于一些优化兼容手段如memo或者forwardRef，则需要你自己手动添加。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useObserver, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> person = useLocalStore(<span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span> &#125;))</span><br><span class="line">  <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;person.name&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> (person.name = &#x27;Mike&#x27;)&#125;&gt;No! I am Mike<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  ))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法有个优点，就是任何的hook改变observable，组件都不会重复渲染。</p>
<p>这个方法有个缺点，就是就算你是在组件的某一部分使用，但是却能引起组件的全部更新~，所以慎用，如果想要精细控制的话，还是要选择<Observer/>或者useForceUpdate。</p>
<h3 id="lesson4-Mange-state-状态管理"><a href="#lesson4-Mange-state-状态管理" class="headerlink" title="lesson4-Mange state-状态管理"></a>lesson4-Mange state-状态管理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLocalStore&lt;T, S&gt;(initializer: () =&gt; T, source?: S): T</span><br></pre></td></tr></table></figure>

<p>本地的observable state可以使用useLocalStore，但是记住一点就是对于每个组件实例，useLocalStore的<strong>初始化函数只执行一次</strong>，并且是在组件的整个生命周期里都有效。</p>
<p>useLocalStore返回对象里的所有属性值都会自动转变为observable，所有getters会被转化为computed属性，所有方法也会与store关联且自动引用 mobx的transaction。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useLocalStore, useObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SmartTodo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> todo = useLocalStore(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Click to toggle&#x27;</span>,</span><br><span class="line">    <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="function"><span class="title">toggle</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      todo.done = !todo.done</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span> <span class="title">emoji</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> todo.done ? <span class="string">&#x27;😜&#x27;</span> : <span class="string">&#x27;🏃&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">onClick</span>=<span class="string">&#123;todo.toggle&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;todo.title&#125; &#123;todo.emoji&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  ))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="不要解构"><a href="#不要解构" class="headerlink" title="不要解构"></a>不要解构</h5><p>解构的话，会破坏响应式。mobx中的observables都是对象，一旦解构，所有的原始变量都会停留在上一个值，而不再是observable了。比如上面的例子中，你可以取值todo.title，但是不能const {title} = todo。</p>
<h5 id="关于全局store"><a href="#关于全局store" class="headerlink" title="关于全局store"></a>关于全局store</h5><p>虽然useLocalStore的命名听着像是只能用在组件内，但实际上，完全可以使用它再加上React Context来处理全局的store。</p>
<h3 id="lesson5-实现mobx-react-lite的useObserver"><a href="#lesson5-实现mobx-react-lite的useObserver" class="headerlink" title="lesson5-实现mobx-react-lite的useObserver"></a>lesson5-实现mobx-react-lite的useObserver</h3><p>useObserver简版实现代码如下，详细参考git-lesson5：<a target="_blank" rel="noopener" href="https://github.com/bubucuo/React-Mobx/tree/lesson5">https://github.com/bubucuo/React-Mobx/tree/lesson5</a></p>
<h5 id="Reaction"><a href="#Reaction" class="headerlink" title="Reaction"></a>Reaction</h5><p>Reaction是一种的特殊的衍生（Derivation），可以注册响应函数，如强制组件更新的forceUpdate。常用于触发副作用，如打印日志、更新 DOM 或者发送网络请求等等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useRef, useReducer, useEffect&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Reaction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useForceUpdate&#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observerComponentNameFor</span>(<span class="params">baseComponentName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`observer<span class="subst">$&#123;baseComponentName&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useObserver</span>(<span class="params">fn, baseComponentName = <span class="string">&quot;observed&quot;</span>, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// const [, forceUpdate] = useReducer(x =&gt; x + 1, 0);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wantedForceUpdateHook = options.useForceUpdate || useForceUpdate;</span><br><span class="line">  <span class="keyword">const</span> forceUpdate = wantedForceUpdateHook();</span><br><span class="line">  <span class="comment">// 组件有初次渲染和更新，那这个时候reaction得做一个缓存，</span></span><br><span class="line">  <span class="keyword">const</span> reactionTrackingRef = useRef(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!reactionTrackingRef.current) &#123;</span><br><span class="line">    reactionTrackingRef.current = &#123;</span><br><span class="line">      <span class="attr">reaction</span>: <span class="keyword">new</span> Reaction(</span><br><span class="line">        observerComponentNameFor(baseComponentName),</span><br><span class="line">        <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 响应函数使用forceUpdate</span></span><br><span class="line">          forceUpdate();</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;reaction&#125; = reactionTrackingRef.current;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 清理reaction</span></span><br><span class="line">      reactionTrackingRef.current.reaction.dispose();</span><br><span class="line">      reactionTrackingRef.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> rendering;</span><br><span class="line"></span><br><span class="line">  reaction.track(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    rendering = fn();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rendering;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="lesson6-实现mobx-react-lite的Observer与observer"><a href="#lesson6-实现mobx-react-lite的Observer与observer" class="headerlink" title="lesson6-实现mobx-react-lite的Observer与observer"></a>lesson6-实现mobx-react-lite的Observer与observer</h3><p>两者都是基于useObserver实现的。</p>
<p>首先是Observer Component，把children或者render作为useObserver的第一个参数作为函数返回即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useObserver&#125; <span class="keyword">from</span> <span class="string">&quot;./useObserver&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObserverComponent</span>(<span class="params">&#123;children, render&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> component = children || render;</span><br><span class="line">  <span class="keyword">return</span> useObserver(component);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;ObserverComponent <span class="keyword">as</span> Observer&#125;;</span><br></pre></td></tr></table></figure>

<p>mobx-react-lite的observer则是相当于在useObserver的基础上再封装了一层forwardRef和memo。</p>
<p>实现代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;memo, forwardRef&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useObserver&#125; <span class="keyword">from</span> <span class="string">&quot;./useObserver&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">baseComponent, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> realOptions = &#123;</span><br><span class="line">    <span class="attr">forwardRef</span>: <span class="literal">false</span>,</span><br><span class="line">    ...options</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> useWrappedComponent = <span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> baseComponent(props, ref));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> memoComponent;</span><br><span class="line">  <span class="keyword">if</span> (realOptions.forwardRef) &#123;</span><br><span class="line">    memoComponent = memo(forwardRef(useWrappedComponent));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    memoComponent = memo(useWrappedComponent);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> memoComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lesson7-详解mobx-react-lite的useAsObservableSource的使用场景及实现"><a href="#lesson7-详解mobx-react-lite的useAsObservableSource的使用场景及实现" class="headerlink" title="lesson7-详解mobx-react-lite的useAsObservableSource的使用场景及实现"></a>lesson7-详解mobx-react-lite的useAsObservableSource的使用场景及实现</h3><p><strong><a href="mailto:&#x6d;&#111;&#98;&#x78;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#x2d;&#108;&#x69;&#x74;&#101;&#64;&#49;&#x2e;&#x33;&#46;&#x30;">&#x6d;&#111;&#98;&#x78;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#x2d;&#108;&#x69;&#x74;&#101;&#64;&#49;&#x2e;&#x33;&#46;&#x30;</a></strong></p>
<p>在不改变原先逻辑的基础上使用mobX。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useAsObservableSource&lt;T&gt;(state: T): T</span><br></pre></td></tr></table></figure>

<h4 id="action"><a href="#action" class="headerlink" title="action"></a>action</h4><p>action接收一个函数并返回具有同样签名的函数，但是用 <code>transaction</code>、<code>untracked</code> 和 <code>allowStateChanges</code> 包裹起来，尤其是 <code>transaction</code> 的自动应用会产生巨大的性能收益， 动作会分批处理变化并只在(最外层的)动作完成后通知计算值和反应。 这将确保在动作完成之前，在动作期间生成的中间值或未完成的值对应用的其余部分是不可见的。</p>
<p>建议对任何修改 observables 或具有副作用的函数使用 <code>(@)action</code> 。 结合开发者工具的话，动作还能提供非常有用的调试信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, action &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = observable(&#123; <span class="attr">value</span>: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> increment = action(<span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    state.value++</span><br><span class="line">    state.value++</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">increment(state)</span><br></pre></td></tr></table></figure>



<h4 id="runInAction-fn"><a href="#runInAction-fn" class="headerlink" title="runInAction(fn)"></a>runInAction(fn)</h4><p><code>runInAction</code> 是个简单的工具函数，它接收代码块并在(异步的)动作中执行。这对于即时创建和执行动作非常有用，例如在异步过程中。<code>runInAction(f)</code> 是 <code>action(f)()</code> 的语法糖。如参考上面action的例子，如果increment只用一次，不想再创建的话，就可以换成用下面的runInAction的写法了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = observable(&#123; <span class="attr">value</span>: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    state.value++</span><br><span class="line">    state.value++</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>再参考个异步的例子，使用async/await + runInAction：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; runInAction, makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    githubProjects = []</span><br><span class="line">    state = <span class="string">&quot;pending&quot;</span> <span class="comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        makeAutoObservable(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">fetchProjects</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.githubProjects = []</span><br><span class="line">        <span class="built_in">this</span>.state = <span class="string">&quot;pending&quot;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> projects = <span class="keyword">await</span> fetchGithubProjectsSomehow()</span><br><span class="line">            <span class="keyword">const</span> filteredProjects = somePreprocessing(projects)</span><br><span class="line">            runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.githubProjects = filteredProjects</span><br><span class="line">                <span class="built_in">this</span>.state = <span class="string">&quot;done&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.state = <span class="string">&quot;error&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="自己手动实现useAsObservableSource-js"><a href="#自己手动实现useAsObservableSource-js" class="headerlink" title="自己手动实现useAsObservableSource.js"></a>自己手动实现useAsObservableSource.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observable, runInAction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useAsObservableSource</span>(<span class="params">current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [res] = React.useState(<span class="function">() =&gt;</span> observable(current));</span><br><span class="line"></span><br><span class="line">  runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(res, current);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lesson8-实现mobx-react-lite的useLocalStore"><a href="#lesson8-实现mobx-react-lite的useLocalStore" class="headerlink" title="lesson8-实现mobx-react-lite的useLocalStore"></a>lesson8-实现mobx-react-lite的useLocalStore</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLocalStore&lt;T, S&gt;(initializer: <span class="function">() =&gt;</span> T, source?: S): T</span><br></pre></td></tr></table></figure>



<h4 id="transaction-事务"><a href="#transaction-事务" class="headerlink" title="transaction(事务)"></a>transaction(事务)</h4><p><em>transaction 是底层 API，在绝大多数场景下 action 或 runInAction 会是更好的选择</em></p>
<p><code>transaction(worker: () =&gt; void)</code> 可以用来批量更新，在事务结束前不会通知任何观察者。 <code>transaction</code> 接收一个无参数的 <code>worker</code> 函数作为参数并运行它。 这个函数完成运行前不会通知任何观察者。 <code>transaction</code> 返回 <code>worker</code> 函数返回的任何值。 注意 <code>transaction</code> 完全是同步运行的。 Transactions 可以嵌套。只有在完成最外面的 <code>transaction</code> 后，其他等待的 reaction 才会运行。</p>
<h4 id="实现useLocalStore"><a href="#实现useLocalStore" class="headerlink" title="实现useLocalStore"></a>实现useLocalStore</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observable, runInAction, transaction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useAsObservableSource&#125; <span class="keyword">from</span> <span class="string">&quot;./useAsObservableSource&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useLocalStore</span>(<span class="params">initializer, current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> source = useAsObservableSource(current);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> React.useState(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> local = observable(initializer(source));</span><br><span class="line">    runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.keys(local).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> value = local[key];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          local[key] = wrapInTransaction(value, local);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> local;</span><br><span class="line">  &#125;)[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapInTransaction</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> transaction(<span class="function">() =&gt;</span> fn.apply(context, args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>注意：useObserver能引起组件的整体渲染，如果想要局部控制的话，可以使用Observer Component。代码示例如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  useLocalStore,</span><br><span class="line">  useObserver,</span><br><span class="line">  useAsObservableSource,</span><br><span class="line">  Observer</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../k-mobx-react-lite/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseLocalStore</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;sss&quot;</span>); <span class="comment">//sy-log</span></span><br><span class="line">  <span class="keyword">const</span> newProps = &#123;...props&#125;; <span class="comment">// useAsObservableSource(props);</span></span><br><span class="line">  <span class="comment">// useLocalStore第一个参数是一个初始化函数，并且这个函数只会执行一次，并且在整个生命周期中都是有效的</span></span><br><span class="line">  <span class="keyword">const</span> countStore = useLocalStore(</span><br><span class="line">    <span class="function"><span class="params">newProps</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">count</span>: props.init === <span class="literal">undefined</span> ? <span class="number">0</span> : props.init,</span><br><span class="line">      <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = <span class="built_in">this</span>.count + <span class="number">1</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">get</span> <span class="title">emoji</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.count % <span class="number">2</span> ? <span class="string">&quot;😜&quot;</span> : <span class="string">&quot;🏃&quot;</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">get</span> <span class="title">specialNum</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> newProps.init &gt; -<span class="number">1</span> &amp;&amp; newProps.init &lt; <span class="number">10</span></span><br><span class="line">          ? <span class="string">&quot;0&quot;</span> + newProps.init</span><br><span class="line">          : newProps.init;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    newProps</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// return useObserver(() =&gt; (</span></span><br><span class="line">  <span class="comment">//   &lt;div className=&quot;border&quot;&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;h3&gt;UseLocalStore&lt;/h3&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;button onClick=&#123;countStore.add&#125;&gt;count: &#123;countStore.count&#125;&lt;/button&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;p&gt;&#123;countStore.emoji&#125;&lt;/p&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;p&gt;&#123;countStore.specialNum&#125;&lt;/p&gt;</span></span><br><span class="line">  <span class="comment">//   &lt;/div&gt;</span></span><br><span class="line">  <span class="comment">// ));</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 局部控制</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;() =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;border&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">h3</span>&gt;</span>UseLocalStore<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;countStore.add&#125;</span>&gt;</span>count: &#123;countStore.count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;countStore.emoji&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;countStore.specialNum&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UseLocalStore;</span><br></pre></td></tr></table></figure>





<h3 id="lesson9-实现mobx-react的observer"><a href="#lesson9-实现mobx-react的observer" class="headerlink" title="lesson9-实现mobx-react的observer"></a>lesson9-实现mobx-react的observer</h3><p>mobx-react@6以后，mobx-react的observer中会判断下是否是函数组件，如果是函数组件，则用的还是mobx-react-lite中的observer，如果是类组件，则调用makeClassComponentObserver。</p>
<p>注意区分：目前<a href="mailto:&#x6d;&#x6f;&#x62;&#x78;&#45;&#114;&#x65;&#x61;&#x63;&#116;&#x2d;&#x6c;&#105;&#116;&#x65;&#64;&#x32;&#46;&#x32;">&#x6d;&#x6f;&#x62;&#x78;&#45;&#114;&#x65;&#x61;&#x63;&#116;&#x2d;&#x6c;&#105;&#116;&#x65;&#64;&#x32;&#46;&#x32;</a>中的observer有forwardRef配置项，但是目前<a href="mailto:&#x6d;&#x6f;&#98;&#120;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#64;&#x36;&#x2e;&#51;&#46;&#x30;">&#x6d;&#x6f;&#98;&#120;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#64;&#x36;&#x2e;&#51;&#46;&#x30;</a>不支持，需要自己配置。</p>
<p>实现代码如下：</p>
<h4 id="observer"><a href="#observer" class="headerlink" title="observer"></a>observer</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observer <span class="keyword">as</span> observerLite, Observer&#125; <span class="keyword">from</span> <span class="string">&quot;../k-mobx-react-lite/&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;makeClassComponentObserver&#125; <span class="keyword">from</span> <span class="string">&quot;./observerClass&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">component, options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// forwardRef</span></span><br><span class="line">  <span class="keyword">if</span> (component[<span class="string">&quot;$$typeof&quot;</span>] === <span class="built_in">Symbol</span>.for(<span class="string">&quot;react.forward_ref&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> baseRender = component[<span class="string">&quot;render&quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> React.forwardRef(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; baseRender.apply(undefined, args)&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 函数组件</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    (<span class="keyword">typeof</span> component === <span class="string">&quot;function&quot;</span> &amp;&amp; !component.prototype) ||</span><br><span class="line">    !component.prototype.render</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> observerLite(component, options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 类组件</span></span><br><span class="line">  <span class="keyword">return</span> makeClassComponentObserver(component);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="makeClassComponentObserver"><a href="#makeClassComponentObserver" class="headerlink" title="makeClassComponentObserver"></a>makeClassComponentObserver</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Reaction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">makeClassComponentObserver</span>(<span class="params">componentClass</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> target = componentClass.prototype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> baseRender = target.render;</span><br><span class="line">  target.render = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> makeComponentReactive.call(<span class="built_in">this</span>, baseRender);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> componentClass;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeComponentReactive</span>(<span class="params">render</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> baseRender = render.bind(<span class="built_in">this</span>);</span><br><span class="line">  <span class="keyword">let</span> isRenderingPending = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> reaction = <span class="keyword">new</span> Reaction(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.constructor.name&#125;</span>.render`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isRenderingPending) &#123;</span><br><span class="line">      isRenderingPending = <span class="literal">true</span>;</span><br><span class="line">      Component.prototype.forceUpdate.call(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.render = reactiveRender;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reactiveRender</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    isRenderingPending = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> rendering = <span class="literal">undefined</span>;</span><br><span class="line">    reaction.track(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      rendering = baseRender();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rendering;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> reactiveRender.call(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lesson10-mobx-react的Provider、inject的使用"><a href="#lesson10-mobx-react的Provider、inject的使用" class="headerlink" title="lesson10-mobx-react的Provider、inject的使用"></a>lesson10-mobx-react的Provider、inject的使用</h3><p><code>Provider</code>是个能够传递store的组件，也支持传递其他非store数据，其实现机制就是React的Context跨层级传递。如果你有一些需要跨层级数据需要传递，可以考虑下这个组件。</p>
<p><code>inject</code>可以用于提取你传输的数据的store，本质上是个高阶组件（hoc）。</p>
<p>参考下面的例子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@inject(<span class="string">&quot;color&quot;</span>)</span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">background:</span> <span class="attr">this.props.color</span> &#125;&#125;&gt;</span>&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> children = <span class="built_in">this</span>.props.messages.map(<span class="function"><span class="params">message</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Message</span> <span class="attr">text</span>=<span class="string">&#123;message.text&#125;</span> /&gt;</span></span>)</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>读取Provider提供的数据不是非得用inject，用React.useContext(MobXProviderContext)也可以，MobXProviderContext来自mobx-react。</li>
<li>使用inject和observer的时候，注意顺序，observer应该是内部，inject在外面。</li>
</ul>
<h3 id="lesson11-实现mobx-react的Provider、inject"><a href="#lesson11-实现mobx-react的Provider、inject" class="headerlink" title="lesson11-实现mobx-react的Provider、inject"></a>lesson11-实现mobx-react的Provider、inject</h3><p>Provider基于Context与组件复合</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useRef, useContext&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;MobXProviderContext&#125; <span class="keyword">from</span> <span class="string">&quot;./MobXProviderContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">&#123;children, ...stores&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> parentValue = useContext(MobXProviderContext);</span><br><span class="line">  <span class="keyword">const</span> mutableProvdierRef = useRef(&#123;...parentValue, ...stores&#125;);</span><br><span class="line">  <span class="keyword">const</span> value = mutableProvdierRef.current;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">MobXProviderContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">MobXProviderContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>inject基于高阶组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useContext&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;MobXProviderContext&#125; <span class="keyword">from</span> <span class="string">&quot;./MobXProviderContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> inject = <span class="function">(<span class="params">...storeNames</span>) =&gt;</span> <span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> Injector = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = useContext(MobXProviderContext);</span><br><span class="line">    <span class="keyword">const</span> newProps = &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      ...context</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (ref) &#123;</span><br><span class="line">      newProps.ref = ref;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(component, newProps);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Injector;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h3 id="lesson12-实现mobx的observable"><a href="#lesson12-实现mobx的observable" class="headerlink" title="lesson12-实现mobx的observable"></a>lesson12-实现mobx的observable</h3><p>MobX 为现有的数据结构(如对象，数组和类实例)添加了可观察的功能，我们通过使用 observable就可以简单地完成这一切。</p>
<p>Observable 值可以是JS基本数据类型、引用类型、普通对象、类实例、数组和映射。</p>
<h4 id="实现observable"><a href="#实现observable" class="headerlink" title="实现observable"></a>实现observable</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> observable = assign(createObservable, observableFactories)</span><br></pre></td></tr></table></figure>



<h4 id="实现extendObservable"><a href="#实现extendObservable" class="headerlink" title="实现extendObservable"></a>实现extendObservable</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extendObservable(target, properties, decorators?, options?)</span><br></pre></td></tr></table></figure>

<p>extendObservable用来向已存在的目标对象添加 observable 属性。 属性映射中的所有键值对都会导致目标上的新的 observable 属性被初始化为给定值。 属性映射中的任意 getters 都会转化成计算属性。</p>
<p><code>decorators</code> 参数用来重载用于指定属性的装饰器，类似于 <code>decorate</code> 和 <code>observable.object</code> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;asObservableObject&#125; <span class="keyword">from</span> <span class="string">&quot;./observableObject&quot;</span>;</span><br><span class="line"><span class="comment">// import &#123;makeProperty&#125; from &quot;./makeObservable&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">extendObservable</span>(<span class="params">target, props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// step1</span></span><br><span class="line">  <span class="keyword">const</span> adm = asObservableObject(target);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// step2</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(props).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// makeProperty(adm, target, key, props[key]);</span></span><br><span class="line">    adm.addObservableProp_(key, props[key]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



























<p>与observable无依赖关系</p>
<p>本地的observable state可以使用useLocalStore，但是记住一点就是对于每个组件实例，useLocalStore的<strong>初始化函数只会执行一次</strong>，并且是在组件的整个生命周期里都有效。</p>
<p>useLocalStore支持你传递一个非observable的plain object作为第二个参数存在这个store的衍生里，它可以是props、useContext甚至是useReducer。当然，这个参数必须得始终保持一种结构，不能用在条件语句中。</p>
<p>注：useLocalStore与useAsObservableSource的区别在于后者只能用于object，如果你不需要action和computed属性，那完全可以使用后者。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import &#123; observer, useLocalStore &#125; from &#x27;mobx-react&#x27; // 6.x</span><br><span class="line"></span><br><span class="line">export const Counter = observer(props =&gt; &#123;</span><br><span class="line">  const store = useLocalStore(</span><br><span class="line">    // don&#x27;t ever destructure source, it won&#x27;t work</span><br><span class="line">    source =&gt; (&#123;</span><br><span class="line">      count: props.initialCount,</span><br><span class="line">      get multiplied() &#123;</span><br><span class="line">        // you shouldn&#x27;t ever refer to props directly here, it won&#x27;t see a change</span><br><span class="line">        return source.multiplier * store.count</span><br><span class="line">      &#125;,</span><br><span class="line">      inc() &#123;</span><br><span class="line">        store.count += 1</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    props, // note props passed here</span><br><span class="line">  )</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;button id=&quot;inc&quot; onClick=&#123;store.inc&#125;&gt;</span><br><span class="line">        &#123;`Count: $&#123;store.count&#125;`&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;span&gt;&#123;store.multiplied&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="lesson-13mobx与redux"><a href="#lesson-13mobx与redux" class="headerlink" title="lesson-13mobx与redux"></a>lesson-13mobx与redux</h3><h4 id="mobx"><a href="#mobx" class="headerlink" title="mobx"></a>mobx</h4><p>它通过透明的函数响应式编程(transparently applying functional reactive programming - TFRP)使得状态管理变得简单和可扩展。MobX背后的哲学很简单:</p>
<p><em>任何源自应用状态的东西都应该自动地获得。</em></p>
<p><img src="https://cn.mobx.js.org/flow.png" alt="MobX unidirectional flow"></p>
<h4 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h4><p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc57dy6j70j31240netja.jpg" alt="image-20200222151958879"></p>
<p>Redux 除了和 <a target="_blank" rel="noopener" href="https://facebook.github.io/react/">React</a> 一起用外，还支持其它界面库。 它体小精悍（只有2kB，包括依赖）。</p>
<p>应用中所有的 state 都以一个对象树的形式储存在一个单一的 <em>store</em> 中。 惟一改变 state 的办法是触发 <em>action</em>，一个描述发生什么的对象。 为了描述 action 如何改变 state 树，你需要编写 <em>reducers</em>。</p>
<h5 id="redux三大原则"><a href="#redux三大原则" class="headerlink" title="redux三大原则"></a>redux三大原则</h5><h6 id="单一数据源"><a href="#单一数据源" class="headerlink" title="单一数据源"></a>单一数据源</h6><p>整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。</p>
<h6 id="State-是只读的"><a href="#State-是只读的" class="headerlink" title="State 是只读的"></a>State 是只读的</h6><p>唯一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</p>
<h6 id="使用纯函数来执行修改"><a href="#使用纯函数来执行修改" class="headerlink" title="使用纯函数来执行修改"></a>使用纯函数来执行修改</h6><p>为了描述 action 如何改变 state tree ，你需要编写 reducers。</p>
<h4 id="不同"><a href="#不同" class="headerlink" title="不同"></a>不同</h4><h5 id="设计思想不同"><a href="#设计思想不同" class="headerlink" title="设计思想不同"></a>设计思想不同</h5><p>Redux遵循函数式编程（Functional Programming, FP）思想，而MobX设计更多偏向于面向对象编程（OOP）和响应式编程（Reactive Programming），MobX中将状态包装成可观察对象，再使用可观察对象的所有能力，一旦状态对象变更，更新就能被自动获得。</p>
<h5 id="对store管理的不同"><a href="#对store管理的不同" class="headerlink" title="对store管理的不同"></a>对store管理的不同</h5><p>在Redux应用中，所有共享的应用数据都集中在一个大的store中，而MboX则通常按模块将应用状态划分，在多个独立的store中管理。</p>
<h5 id="工作方式不同"><a href="#工作方式不同" class="headerlink" title="工作方式不同"></a>工作方式不同</h5><p>Redux中用js对象存储状态数据，并且手动追踪状态变更，而MobX中会把状态数据转化为可观察的对象，当状态发生变化，自动触发监听。</p>
<h5 id="状态修改方式"><a href="#状态修改方式" class="headerlink" title="状态修改方式"></a>状态修改方式</h5><p>Redux中的不可以直接修改状态，只能通过dispatch派发事件修改，而MobX中则可以直接修改，也可以通过action修改，比较”灵活“，但是这种灵活不利于项目管理与维护，因此建议还是开启严格模式，从而禁止掉直接修改状态的方式，并且制定状态管理规范。</p>
<h5 id="不可变（Immutable）和可变（Mutable）"><a href="#不可变（Immutable）和可变（Mutable）" class="headerlink" title="不可变（Immutable）和可变（Mutable）"></a>不可变（Immutable）和可变（Mutable）</h5><p>Redux状态对象通常是不可变的（Immutable），我们使用reducers，并且在原来对象的基础上返回一个新的状态对象，这样就能很方便的返回上一个状态，但是MobX中则可由直接使用新值更新状态对象。</p>
<h5 id="mobx-react和react-reudx"><a href="#mobx-react和react-reudx" class="headerlink" title="mobx-react和react-reudx"></a>mobx-react和react-reudx</h5><p>各自都有React绑定库，且绑定库设计与思想相似，react-redux中有Provider与connect，mobx-react中有Provider和inject，都有Context和HOC设计，后期都可以用hooks代替。</p>
<h5 id="体积不同"><a href="#体积不同" class="headerlink" title="体积不同"></a>体积不同</h5><p>Redux体小精悍、周边配合库非常丰富，如redux-thunk中间件等。mobx库则功能强大，自己就能独立完成很多功能，如异步等。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>如果你不懂Redux中的reducers、中间件等这些概念，<code>MobX</code>入门也许相对简单，构建项目当然也很快，但是当项目足够大的时候，其实难度不会天差地别，都需要开发者对库本身能有深刻的理解。目前更多人选择使用Redux，尤其是大型项目，而选择MobX的则中小型项目多一些，MobX好理解、自由，这当然是个优势，但是同时也带来了劣势，过于自由对于项目管理当然是巨大的缺点，因此使用MobX需要开发者约定规范。所以，我个人认为，选择MobX还是Redux用于状态管理，或者你有第三第四个别的选择，根据自己的项目和个人对于各自库的掌握度来做选择就可以了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">xincheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/11/01/MobX%E6%96%87%E6%A1%A3/">http://example.com/2021/11/01/MobX文档/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1638979193&amp;t=85f0a5750ddf5762669a9bf2aaac970b" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/10/08/regular-expression/"><img class="next-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.php.cn%2Fupload%2Farticle%2F000%2F000%2F007%2F2e1367cda06e541fb8d477d250d8daf6.jpg&amp;refer=http%3A%2F%2Fimg.php.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1637719211&amp;t=d4dc21fdbbb8305765f04850f362555e" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">regular-expression</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">xincheng</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SevenWang666" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/sevenw6666@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MobX%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">MobX文档</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-number">1.1.</span> <span class="toc-text">资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">关于库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">1.3.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MobX%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">MobX简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.3.2.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson1-MobX%E8%A6%81%E7%82%B9"><span class="toc-number">1.3.4.</span> <span class="toc-text">lesson1-MobX要点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E5%B9%B6%E4%BD%BF%E5%85%B6%E5%8F%AF%E8%A7%82%E5%AF%9F"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">1. 定义状态并使其可观察</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E4%BB%A5%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">2. 创建视图以响应状态的变化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9B%B4%E6%94%B9%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">3. 更改状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson2-MobX-API-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.5.</span> <span class="toc-text">lesson2-MobX API 概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Observable-state-%E5%8F%AF%E8%A7%82%E5%AF%9F%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">Observable state(可观察的状态)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Computed-values-%E8%AE%A1%E7%AE%97%E5%80%BC"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">Computed values(计算值)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reactions-%E5%8F%8D%E5%BA%94"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">Reactions(反应)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#React-%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.5.3.1.</span> <span class="toc-text">React 组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-reactions"><span class="toc-number">1.3.5.3.2.</span> <span class="toc-text">自定义 reactions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MobX-%E4%BC%9A%E5%AF%B9%E4%BB%80%E4%B9%88%E4%BD%9C%E5%87%BA%E5%93%8D%E5%BA%94"><span class="toc-number">1.3.5.3.3.</span> <span class="toc-text">MobX 会对什么作出响应?</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actions-%E5%8A%A8%E4%BD%9C"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">Actions(动作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enforceActions"><span class="toc-number">1.3.5.5.</span> <span class="toc-text">enforceActions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson3-%E7%BB%99%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="toc-number">1.3.6.</span> <span class="toc-text">lesson3-给组件添加响应式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#observer-HOC"><span class="toc-number">1.3.6.0.1.</span> <span class="toc-text">observer HOC</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Observer-component"><span class="toc-number">1.3.6.0.2.</span> <span class="toc-text">Observer component</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#useObserver-hook"><span class="toc-number">1.3.6.0.3.</span> <span class="toc-text">useObserver hook</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson4-Mange-state-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.7.</span> <span class="toc-text">lesson4-Mange state-状态管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E8%A6%81%E8%A7%A3%E6%9E%84"><span class="toc-number">1.3.7.0.1.</span> <span class="toc-text">不要解构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%85%A8%E5%B1%80store"><span class="toc-number">1.3.7.0.2.</span> <span class="toc-text">关于全局store</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson5-%E5%AE%9E%E7%8E%B0mobx-react-lite%E7%9A%84useObserver"><span class="toc-number">1.3.8.</span> <span class="toc-text">lesson5-实现mobx-react-lite的useObserver</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Reaction"><span class="toc-number">1.3.8.0.1.</span> <span class="toc-text">Reaction</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">1.3.8.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson6-%E5%AE%9E%E7%8E%B0mobx-react-lite%E7%9A%84Observer%E4%B8%8Eobserver"><span class="toc-number">1.3.9.</span> <span class="toc-text">lesson6-实现mobx-react-lite的Observer与observer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson7-%E8%AF%A6%E8%A7%A3mobx-react-lite%E7%9A%84useAsObservableSource%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.10.</span> <span class="toc-text">lesson7-详解mobx-react-lite的useAsObservableSource的使用场景及实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#action"><span class="toc-number">1.3.10.1.</span> <span class="toc-text">action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#runInAction-fn"><span class="toc-number">1.3.10.2.</span> <span class="toc-text">runInAction(fn)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0useAsObservableSource-js"><span class="toc-number">1.3.10.3.</span> <span class="toc-text">自己手动实现useAsObservableSource.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson8-%E5%AE%9E%E7%8E%B0mobx-react-lite%E7%9A%84useLocalStore"><span class="toc-number">1.3.11.</span> <span class="toc-text">lesson8-实现mobx-react-lite的useLocalStore</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#transaction-%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.11.1.</span> <span class="toc-text">transaction(事务)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0useLocalStore"><span class="toc-number">1.3.11.2.</span> <span class="toc-text">实现useLocalStore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.3.11.3.</span> <span class="toc-text">例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson9-%E5%AE%9E%E7%8E%B0mobx-react%E7%9A%84observer"><span class="toc-number">1.3.12.</span> <span class="toc-text">lesson9-实现mobx-react的observer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#observer"><span class="toc-number">1.3.12.1.</span> <span class="toc-text">observer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#makeClassComponentObserver"><span class="toc-number">1.3.12.2.</span> <span class="toc-text">makeClassComponentObserver</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson10-mobx-react%E7%9A%84Provider%E3%80%81inject%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.13.</span> <span class="toc-text">lesson10-mobx-react的Provider、inject的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson11-%E5%AE%9E%E7%8E%B0mobx-react%E7%9A%84Provider%E3%80%81inject"><span class="toc-number">1.3.14.</span> <span class="toc-text">lesson11-实现mobx-react的Provider、inject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson12-%E5%AE%9E%E7%8E%B0mobx%E7%9A%84observable"><span class="toc-number">1.3.15.</span> <span class="toc-text">lesson12-实现mobx的observable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0observable"><span class="toc-number">1.3.15.1.</span> <span class="toc-text">实现observable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0extendObservable"><span class="toc-number">1.3.15.2.</span> <span class="toc-text">实现extendObservable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson-13mobx%E4%B8%8Eredux"><span class="toc-number">1.3.16.</span> <span class="toc-text">lesson-13mobx与redux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mobx"><span class="toc-number">1.3.16.1.</span> <span class="toc-text">mobx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redux"><span class="toc-number">1.3.16.2.</span> <span class="toc-text">redux</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#redux%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.16.2.1.</span> <span class="toc-text">redux三大原则</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">1.3.16.2.1.1.</span> <span class="toc-text">单一数据源</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#State-%E6%98%AF%E5%8F%AA%E8%AF%BB%E7%9A%84"><span class="toc-number">1.3.16.2.1.2.</span> <span class="toc-text">State 是只读的</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BA%AF%E5%87%BD%E6%95%B0%E6%9D%A5%E6%89%A7%E8%A1%8C%E4%BF%AE%E6%94%B9"><span class="toc-number">1.3.16.2.1.3.</span> <span class="toc-text">使用纯函数来执行修改</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.</span> <span class="toc-text">不同</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.1.</span> <span class="toc-text">设计思想不同</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9store%E7%AE%A1%E7%90%86%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.2.</span> <span class="toc-text">对store管理的不同</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.3.</span> <span class="toc-text">工作方式不同</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E4%BF%AE%E6%94%B9%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.16.3.4.</span> <span class="toc-text">状态修改方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98%EF%BC%88Immutable%EF%BC%89%E5%92%8C%E5%8F%AF%E5%8F%98%EF%BC%88Mutable%EF%BC%89"><span class="toc-number">1.3.16.3.5.</span> <span class="toc-text">不可变（Immutable）和可变（Mutable）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mobx-react%E5%92%8Creact-reudx"><span class="toc-number">1.3.16.3.6.</span> <span class="toc-text">mobx-react和react-reudx</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%93%E7%A7%AF%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.7.</span> <span class="toc-text">体积不同</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.16.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/11/01/MobX%E6%96%87%E6%A1%A3/" title="mobx文档"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1638979193&amp;t=85f0a5750ddf5762669a9bf2aaac970b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mobx文档"/></a><div class="content"><a class="title" href="/2021/11/01/MobX%E6%96%87%E6%A1%A3/" title="mobx文档">mobx文档</a><time datetime="2021-11-01T00:00:00.000Z" title="Created 2021-11-01 00:00:00">2021-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/08/regular-expression/" title="regular-expression"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.php.cn%2Fupload%2Farticle%2F000%2F000%2F007%2F2e1367cda06e541fb8d477d250d8daf6.jpg&amp;refer=http%3A%2F%2Fimg.php.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1637719211&amp;t=d4dc21fdbbb8305765f04850f362555e" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="regular-expression"/></a><div class="content"><a class="title" href="/2021/10/08/regular-expression/" title="regular-expression">regular-expression</a><time datetime="2021-10-08T00:00:00.000Z" title="Created 2021-10-08 00:00:00">2021-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/25/index/" title="test"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimages.h128.com%2Fupload%2F202002%2F23%2F202002231023110838.jpg%3Fx-oss-process%3Dimage%2Fauto-orient%2C1%2Fresize%2Cm_fill%2Cw_1421%2Ch_888%2Fquality%2Cq_100%2Fformat%2Cjpg&amp;refer=http%3A%2F%2Fimages.h128.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1632491725&amp;t=98dab7d2dc35b555928c1e20aad1981c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="test"/></a><div class="content"><a class="title" href="/2021/08/25/index/" title="test">test</a><time datetime="2021-08-25T15:36:11.000Z" title="Created 2021-08-25 15:36:11">2021-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/20/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84js/" title="你不了解的js"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Ffile01.dysucai.com%2Fd%2Ffile%2Flan2019010710%2Fibc3hrkwce1.jpg&amp;refer=http%3A%2F%2Ffile01.dysucai.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1632491575&amp;t=96e7f86935a561f8f50b380305881f79" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="你不了解的js"/></a><div class="content"><a class="title" href="/2021/08/20/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84js/" title="你不了解的js">你不了解的js</a><time datetime="2021-08-20T00:00:00.000Z" title="Created 2021-08-20 00:00:00">2021-08-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: #0000006b"><div id="footer-wrap"><div class="copyright">&copy;2021 By xincheng</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<a href="http://beian.miit.gov.cn/"  target="_blank">赣ICP备2021007007号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>