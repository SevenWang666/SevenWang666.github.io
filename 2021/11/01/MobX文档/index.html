<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>mobxæ–‡æ¡£ | xincheng</title><meta name="author" content="xincheng"><meta name="copyright" content="xincheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MobXæ–‡æ¡£èµ„æº mobxä¸­æ–‡æ–‡æ¡£  mobxæºç åœ°å€  mobx-react-liteè‹±æ–‡æ–‡æ¡£ï¼ˆæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°å®Œæ•´ç‰ˆçš„ä¸­æ–‡ç‰ˆæ–‡æ¡£ï¼‰  mobx-reactæºç åœ°å€(ä¸‹é¢çš„README.mdé‡Œæ˜¯å®Œæ•´ç‰ˆæœ¬çš„è‹±æ–‡æ–‡æ¡£)  mobx-react-liteæºç åœ°å€ â€‹       å…³äºåº“mobxï¼šæä¾›observableã€actionã€computedç­‰APIçš„åº“ï¼Œç±»æ¯”reduxã€‚ mobx-reactï¼šæ">
<meta property="og:type" content="article">
<meta property="og:title" content="mobxæ–‡æ¡£">
<meta property="og:url" content="http://example.com/2021/11/01/MobX%E6%96%87%E6%A1%A3/index.html">
<meta property="og:site_name" content="xincheng">
<meta property="og:description" content="MobXæ–‡æ¡£èµ„æº mobxä¸­æ–‡æ–‡æ¡£  mobxæºç åœ°å€  mobx-react-liteè‹±æ–‡æ–‡æ¡£ï¼ˆæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°å®Œæ•´ç‰ˆçš„ä¸­æ–‡ç‰ˆæ–‡æ¡£ï¼‰  mobx-reactæºç åœ°å€(ä¸‹é¢çš„README.mdé‡Œæ˜¯å®Œæ•´ç‰ˆæœ¬çš„è‹±æ–‡æ–‡æ¡£)  mobx-react-liteæºç åœ°å€ â€‹       å…³äºåº“mobxï¼šæä¾›observableã€actionã€computedç­‰APIçš„åº“ï¼Œç±»æ¯”reduxã€‚ mobx-reactï¼šæ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1638979193&t=85f0a5750ddf5762669a9bf2aaac970b">
<meta property="article:published_time" content="2021-11-01T00:00:00.000Z">
<meta property="article:modified_time" content="2021-11-08T16:15:04.548Z">
<meta property="article:author" content="xincheng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1638979193&t=85f0a5750ddf5762669a9bf2aaac970b"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/11/01/MobX%E6%96%87%E6%A1%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mobxæ–‡æ¡£',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-08 16:15:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="xincheng" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> æ¸…å•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1638979193&amp;t=85f0a5750ddf5762669a9bf2aaac970b')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">xincheng</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> æ¸…å•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">mobxæ–‡æ¡£</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-11-01T00:00:00.000Z" title="Created 2021-11-01 00:00:00">2021-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-11-08T16:15:04.548Z" title="Updated 2021-11-08 16:15:04">2021-11-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">6.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>28min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="mobxæ–‡æ¡£"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MobXæ–‡æ¡£"><a href="#MobXæ–‡æ¡£" class="headerlink" title="MobXæ–‡æ¡£"></a>MobXæ–‡æ¡£</h1><h2 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://cn.mobx.js.org/">mobxä¸­æ–‡æ–‡æ¡£</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mobxjs/mobx">mobxæºç åœ°å€</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mobx-react.js.org/">mobx-react-liteè‹±æ–‡æ–‡æ¡£ï¼ˆæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°å®Œæ•´ç‰ˆçš„ä¸­æ–‡ç‰ˆæ–‡æ¡£ï¼‰</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mobxjs/mobx-react">mobx-reactæºç åœ°å€</a>(ä¸‹é¢çš„README.mdé‡Œæ˜¯å®Œæ•´ç‰ˆæœ¬çš„è‹±æ–‡æ–‡æ¡£)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mobxjs/mobx-react-lite">mobx-react-liteæºç åœ°å€</a></p>
<p>â€‹    </p>
</li>
</ol>
<h2 id="å…³äºåº“"><a href="#å…³äºåº“" class="headerlink" title="å…³äºåº“"></a>å…³äºåº“</h2><p><strong>mobx</strong>ï¼šæä¾›observableã€actionã€computedç­‰APIçš„åº“ï¼Œç±»æ¯”reduxã€‚</p>
<p><strong>mobx-react</strong>ï¼šæä¾›Providerã€injectã€observerã€Observerã€useObserverã€useAsObservableSourceã€ useLocalStoreç­‰APIçš„åº“ã€‚æœ€æ–°ç‰ˆçš„mobx-reactä¸­åŒ…æ‹¬äº†mobx-react-liteã€‚</p>
<p><strong>mobx-react-lite</strong>ï¼šç›¸å½“äºæ˜¯mobx-reactçš„ç²¾ç®€ç‰ˆï¼Œä¸æ”¯æŒProviderã€injectï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥ä¾é React Contextè‡ªå·±å®ç°è¿™ä¸¤ä¸ªAPIçš„åŠŸèƒ½ã€‚</p>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="MobXç®€ä»‹"><a href="#MobXç®€ä»‹" class="headerlink" title="MobXç®€ä»‹"></a>MobXç®€ä»‹</h3><p>ç®€å•ã€å¯æ‰©å±•çš„çŠ¶æ€ç®¡ç†ã€‚</p>
<p>å®‰è£… <code>yarn add mobx </code></p>
<p>React ç»‘å®šåº“: <code>yarn add mobx-react</code></p>
<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><pre><code> MobX å¯ä»¥é€šè¿‡ *decorate* å·¥å…·åœ¨ä¸æ”¯æŒè£…é¥°å™¨è¯­æ³•çš„æƒ…å†µåŠ ä½¿ç”¨ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œå¤šæ•° MobX ç”¨æˆ·æ›´å–œæ¬¢è£…é¥°å™¨è¯­æ³•ï¼Œå› ä¸ºå®ƒæ›´ç®€æ´ã€‚
</code></pre>
<p>è£…é¥°å™¨å‚è€ƒ<a target="_blank" rel="noopener" href="https://cn.mobx.js.org/best/decorators.html">https://cn.mobx.js.org/best/decorators.html</a></p>
<h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><p>MobXé€šè¿‡é€æ˜çš„å‡½æ•°å“åº”å¼ç¼–ç¨‹(transparently applying functional reactive programming - TFRP)ä½¿å¾—çŠ¶æ€ç®¡ç†å˜å¾—ç®€å•å’Œå¯æ‰©å±•ã€‚MobXèƒŒåçš„å“²å­¦å¾ˆç®€å•:</p>
<p><em>ä»»ä½•æºè‡ªåº”ç”¨çŠ¶æ€çš„ä¸œè¥¿éƒ½åº”è¯¥è‡ªåŠ¨åœ°è·å¾—ã€‚</em></p>
<p>å…¶ä¸­åŒ…æ‹¬UIã€æ•°æ®åºåˆ—åŒ–ã€æœåŠ¡å™¨é€šè®¯ï¼Œç­‰ç­‰ã€‚</p>
<p><img src="https://cn.mobx.js.org/flow.png" alt="MobX unidirectional flow"></p>
<p>React å’Œ MobX æ˜¯ä¸€å¯¹å¼ºåŠ›ç»„åˆã€‚React é€šè¿‡æä¾›æœºåˆ¶æŠŠåº”ç”¨çŠ¶æ€è½¬æ¢ä¸ºå¯æ¸²æŸ“ç»„ä»¶æ ‘å¹¶å¯¹å…¶è¿›è¡Œæ¸²æŸ“ã€‚è€ŒMobXæä¾›æœºåˆ¶æ¥å­˜å‚¨å’Œæ›´æ–°åº”ç”¨çŠ¶æ€ä¾› React ä½¿ç”¨ã€‚</p>
<p>å¯¹äºåº”ç”¨å¼€å‘ä¸­çš„å¸¸è§é—®é¢˜ï¼ŒReact å’Œ MobX éƒ½æä¾›äº†æœ€ä¼˜å’Œç‹¬ç‰¹çš„è§£å†³æ–¹æ¡ˆã€‚React æä¾›äº†ä¼˜åŒ–UIæ¸²æŸ“çš„æœºåˆ¶ï¼Œ è¿™ç§æœºåˆ¶å°±æ˜¯é€šè¿‡ä½¿ç”¨è™šæ‹ŸDOMæ¥å‡å°‘æ˜‚è´µçš„DOMå˜åŒ–çš„æ•°é‡ã€‚MobX æä¾›äº†ä¼˜åŒ–åº”ç”¨çŠ¶æ€ä¸ React ç»„ä»¶åŒæ­¥çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶å°±æ˜¯ä½¿ç”¨å“åº”å¼è™šæ‹Ÿä¾èµ–çŠ¶æ€å›¾è¡¨ï¼Œå®ƒåªæœ‰åœ¨çœŸæ­£éœ€è¦çš„æ—¶å€™æ‰æ›´æ–°å¹¶ä¸”æ°¸è¿œä¿æŒæ˜¯æœ€æ–°çš„ã€‚</p>
<h3 id="lesson1-MobXè¦ç‚¹"><a href="#lesson1-MobXè¦ç‚¹" class="headerlink" title="lesson1-MobXè¦ç‚¹"></a>lesson1-MobXè¦ç‚¹</h3><h4 id="1-å®šä¹‰çŠ¶æ€å¹¶ä½¿å…¶å¯è§‚å¯Ÿ"><a href="#1-å®šä¹‰çŠ¶æ€å¹¶ä½¿å…¶å¯è§‚å¯Ÿ" class="headerlink" title="1. å®šä¹‰çŠ¶æ€å¹¶ä½¿å…¶å¯è§‚å¯Ÿ"></a>1. å®šä¹‰çŠ¶æ€å¹¶ä½¿å…¶å¯è§‚å¯Ÿ</h4><p>å¯ä»¥ç”¨ä»»ä½•ä½ å–œæ¬¢çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨çŠ¶æ€ï¼Œå¦‚å¯¹è±¡ã€æ•°ç»„ã€ç±»ã€‚ å¾ªç¯æ•°æ®ç»“æ„ã€å¼•ç”¨ï¼Œéƒ½æ²¡æœ‰å…³ç³»ã€‚ åªè¦ç¡®ä¿æ‰€æœ‰ä¼šéšæ—¶é—´æµé€è€Œæ”¹å˜çš„å±æ€§æ‰“ä¸Š <code>mobx</code> çš„æ ‡è®°ä½¿å®ƒä»¬å˜å¾—å¯è§‚å¯Ÿå³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;observable&#125; <span class="keyword">from</span> <span class="string">&#x27;mobx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> appState = observable(&#123;</span><br><span class="line">    <span class="attr">timer</span>: <span class="number">0</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="2-åˆ›å»ºè§†å›¾ä»¥å“åº”çŠ¶æ€çš„å˜åŒ–"><a href="#2-åˆ›å»ºè§†å›¾ä»¥å“åº”çŠ¶æ€çš„å˜åŒ–" class="headerlink" title="2. åˆ›å»ºè§†å›¾ä»¥å“åº”çŠ¶æ€çš„å˜åŒ–"></a>2. åˆ›å»ºè§†å›¾ä»¥å“åº”çŠ¶æ€çš„å˜åŒ–</h4><p>æˆ‘ä»¬çš„ <code>appState</code> è¿˜æ²¡æœ‰è§‚å¯Ÿåˆ°ä»»ä½•çš„ä¸œè¥¿ã€‚ ä½ å¯ä»¥åˆ›å»ºè§†å›¾ï¼Œå½“ <code>appState</code> ä¸­ç›¸å…³æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶è§†å›¾ä¼šè‡ªåŠ¨æ›´æ–°ã€‚ MobX ä¼šä»¥ä¸€ç§æœ€å°é™åº¦çš„æ–¹å¼æ¥æ›´æ–°è§†å›¾ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observer&#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react&quot;</span>;</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerView</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  onReset = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.appState.resetTimer();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onReset&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Seconds passed: &#123;this.props.appState.timer&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TimerView;</span><br></pre></td></tr></table></figure>



<h4 id="3-æ›´æ”¹çŠ¶æ€"><a href="#3-æ›´æ”¹çŠ¶æ€" class="headerlink" title="3. æ›´æ”¹çŠ¶æ€"></a>3. æ›´æ”¹çŠ¶æ€</h4><p>ç¬¬ä¸‰ä»¶è¦åšçš„äº‹å°±æ˜¯æ›´æ”¹çŠ¶æ€ã€‚ ä¹Ÿå°±æ˜¯ä½ çš„åº”ç”¨ç©¶ç«Ÿè¦åšä»€ä¹ˆã€‚ ä¸åƒä¸€äº›å…¶å®ƒæ¡†æ¶ï¼ŒMobX ä¸ä¼šå‘½ä»¤ä½ å¦‚ä½•å¦‚ä½•å»åšã€‚ è¿™æ˜¯æœ€ä½³å®è·µï¼Œä½†å…³é”®è¦è®°ä½ä¸€ç‚¹: <strong>MobX å¸®åŠ©ä½ ä»¥ä¸€ç§ç®€å•ç›´è§‚çš„æ–¹å¼æ¥å®Œæˆå·¥ä½œ</strong>ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç æ¯ç§’éƒ½ä¼šä¿®æ”¹ä½ çš„æ•°æ®ï¼Œè€Œå½“éœ€è¦çš„æ—¶å€™UIä¼šè‡ªåŠ¨æ›´æ–°ã€‚ æ— è®ºæ˜¯åœ¨<strong>æ”¹å˜</strong>çŠ¶æ€çš„æ§åˆ¶å™¨å‡½æ•°ä¸­ï¼Œè¿˜æ˜¯åœ¨åº”è¯¥<strong>æ›´æ–°</strong>çš„è§†å›¾ä¸­ï¼Œéƒ½æ²¡æœ‰æ˜ç¡®çš„å…³ç³»å®šä¹‰ã€‚ ä½¿ç”¨ <code>observable</code> æ¥è£…é¥°ä½ çš„<strong>çŠ¶æ€</strong>å’Œ<strong>è§†å›¾</strong>ï¼Œè¿™è¶³ä»¥è®© MobXæ£€æµ‹æ‰€æœ‰å…³ç³»äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appState.resetTimer = action(<span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    appState.timer = <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(action(<span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    appState.timer += <span class="number">1</span>;</span><br><span class="line">&#125;), <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>åªæœ‰åœ¨ä¸¥æ ¼æ¨¡å¼(é»˜è®¤æ˜¯ä¸å¯ç”¨)ä¸‹ä½¿ç”¨ MobX æ—¶æ‰éœ€è¦ <code>action</code> åŒ…è£…ã€‚ å»ºè®®ä½¿ç”¨ actionï¼Œå› ä¸ºå®ƒå°†å¸®åŠ©ä½ æ›´å¥½åœ°ç»„ç»‡åº”ç”¨ï¼Œå¹¶è¡¨è¾¾å‡ºä¸€ä¸ªå‡½æ•°ä¿®æ”¹çŠ¶æ€çš„æ„å›¾ã€‚ åŒæ—¶,å®ƒè¿˜è‡ªåŠ¨åº”ç”¨äº‹åŠ¡ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚</p>
<h3 id="lesson2-MobX-API-æ¦‚å¿µ"><a href="#lesson2-MobX-API-æ¦‚å¿µ" class="headerlink" title="lesson2-MobX API æ¦‚å¿µ"></a>lesson2-MobX API æ¦‚å¿µ</h3><h4 id="Observable-state-å¯è§‚å¯Ÿçš„çŠ¶æ€"><a href="#Observable-state-å¯è§‚å¯Ÿçš„çŠ¶æ€" class="headerlink" title="Observable state(å¯è§‚å¯Ÿçš„çŠ¶æ€)"></a>Observable state(å¯è§‚å¯Ÿçš„çŠ¶æ€)</h4><p>MobX ä¸ºç°æœ‰çš„æ•°æ®ç»“æ„(å¦‚å¯¹è±¡ï¼Œæ•°ç»„å’Œç±»å®ä¾‹)æ·»åŠ äº†å¯è§‚å¯Ÿçš„åŠŸèƒ½ã€‚ é€šè¿‡ä½¿ç”¨ <a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/observable-decorator.html">@observable</a> è£…é¥°å™¨(ES.Next)æ¥ç»™ä½ çš„ç±»å±æ€§æ·»åŠ æ³¨è§£å°±å¯ä»¥ç®€å•åœ°å®Œæˆè¿™ä¸€åˆ‡ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;observable, computed&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> </span>&#123;</span><br><span class="line">  @observable todos = [</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="string">&quot;0&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;ä»»åŠ¡0&quot;</span>, <span class="attr">finished</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="string">&quot;1&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;ä»»åŠ¡1&quot;</span>, <span class="attr">finished</span>: <span class="literal">false</span>&#125;</span><br><span class="line">  ];</span><br><span class="line">  @computed <span class="keyword">get</span> <span class="title">unfinishedTodoCount</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.finished).length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Computed-values-è®¡ç®—å€¼"><a href="#Computed-values-è®¡ç®—å€¼" class="headerlink" title="Computed values(è®¡ç®—å€¼)"></a>Computed values(è®¡ç®—å€¼)</h4><p>å®šä¹‰åœ¨ç›¸å…³æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°çš„å€¼ã€‚å¦‚ä¸Šæ®µä»£ç ï¼Œå½“æ·»åŠ äº†ä¸€ä¸ªæ–°çš„todoæˆ–è€…æŸä¸ªtodoçš„ <code>finished</code> å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒMobX ä¼šç¡®ä¿ <code>unfinishedTodoCount</code> è‡ªåŠ¨æ›´æ–°ã€‚</p>
<h4 id="Reactions-ååº”"><a href="#Reactions-ååº”" class="headerlink" title="Reactions(ååº”)"></a>Reactions(ååº”)</h4><p>Reactions å’Œè®¡ç®—å€¼å¾ˆåƒï¼Œä½†å®ƒä¸æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„å€¼ï¼Œè€Œæ˜¯ä¼šäº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚æ‰“å°åˆ°æ§åˆ¶å°ã€ç½‘ç»œè¯·æ±‚ã€é€’å¢åœ°æ›´æ–° React ç»„ä»¶æ ‘ä»¥ä¿®è¡¥DOMã€ç­‰ç­‰ã€‚</p>
<h5 id="React-ç»„ä»¶"><a href="#React-ç»„ä»¶" class="headerlink" title="React ç»„ä»¶"></a>React ç»„ä»¶</h5><p>å¦‚æœä½ ç”¨ React çš„è¯ï¼Œå¯ä»¥æŠŠä½ çš„(æ— çŠ¶æ€å‡½æ•°)ç»„ä»¶å˜æˆå“åº”å¼ç»„ä»¶ï¼Œæ–¹æ³•æ˜¯åœ¨ç»„ä»¶ä¸Šæ·»åŠ  <a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/observable-decorator.html"><code>observer</code></a> å‡½æ•°/ è£…é¥°å™¨. <code>observer</code>ç”± <code>mobx-react</code> åŒ…æä¾›çš„ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;observer&#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react&quot;</span>;</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoListView</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;todos, unfinishedTodoCount&#125; = <span class="built_in">this</span>.props.todoList;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;todos.map(todo =&gt; (</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TodoView</span> <span class="attr">todo</span>=<span class="string">&#123;todo&#125;</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Tasks left: &#123;unfinishedTodoCount&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoView = observer(<span class="function">(<span class="params">&#123;todo&#125;</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">checked</span>=<span class="string">&#123;todo.finished&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> todo.finished = !todo.finished&#125;</span></span><br><span class="line"><span class="xml">        /&gt;&#123;todo.title&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> TodoList();</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TodoListView</span> <span class="attr">todoList</span>=<span class="string">&#123;store&#125;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h5 id="è‡ªå®šä¹‰-reactions"><a href="#è‡ªå®šä¹‰-reactions" class="headerlink" title="è‡ªå®šä¹‰ reactions"></a>è‡ªå®šä¹‰ reactions</h5><p>ä½¿ç”¨<a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/autorun.html"><code>autorun</code></a>ã€<a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/reaction.html"><code>reaction</code></a> å’Œ <a target="_blank" rel="noopener" href="http://cn.mobx.js.org/refguide/when.html"><code>when</code></a> å‡½æ•°å³å¯ç®€å•çš„åˆ›å»ºè‡ªå®šä¹‰ reactionsï¼Œä»¥æ»¡è¶³ä½ çš„å…·ä½“åœºæ™¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ¯å½“ <code>unfinishedTodoCount</code> çš„æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸‹é¢çš„ <code>autorun</code> ä¼šæ‰“å°æ—¥å¿—æ¶ˆæ¯:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">autorun(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Tasks left: &quot;</span> + todos.unfinishedTodoCount)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h5 id="MobX-ä¼šå¯¹ä»€ä¹ˆä½œå‡ºå“åº”"><a href="#MobX-ä¼šå¯¹ä»€ä¹ˆä½œå‡ºå“åº”" class="headerlink" title="MobX ä¼šå¯¹ä»€ä¹ˆä½œå‡ºå“åº”?"></a>MobX ä¼šå¯¹ä»€ä¹ˆä½œå‡ºå“åº”?</h5><p><em>MobX ä¼šå¯¹åœ¨æ‰§è¡Œè·Ÿè¸ªå‡½æ•°æœŸé—´è¯»å–çš„ä»»ä½•ç°æœ‰çš„å¯è§‚å¯Ÿå±æ€§åšå‡ºååº”</em>ã€‚</p>
<h4 id="Actions-åŠ¨ä½œ"><a href="#Actions-åŠ¨ä½œ" class="headerlink" title="Actions(åŠ¨ä½œ)"></a>Actions(åŠ¨ä½œ)</h4><p>ä»»ä½•åº”ç”¨éƒ½æœ‰åŠ¨ä½œã€‚åŠ¨ä½œæ˜¯ä»»ä½•ç”¨æ¥ä¿®æ”¹çŠ¶æ€çš„ä¸œè¥¿ã€‚</p>
<p>ä½¿ç”¨MobXä½ å¯ä»¥åœ¨ä»£ç ä¸­æ˜¾å¼åœ°æ ‡è®°å‡ºåŠ¨ä½œæ‰€åœ¨çš„ä½ç½®ã€‚ åŠ¨ä½œå¯ä»¥æœ‰åŠ©äºæ›´å¥½çš„ç»„ç»‡ä»£ç ã€‚ å»ºè®®åœ¨ä»»ä½•æ›´æ”¹ observable æˆ–è€…æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ä¸Šä½¿ç”¨åŠ¨ä½œã€‚ ç»“åˆå¼€å‘è€…å·¥å…·çš„è¯ï¼ŒåŠ¨ä½œè¿˜èƒ½æä¾›éå¸¸æœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯ã€‚ æ³¨æ„: å½“å¯ç”¨<strong>ä¸¥æ ¼æ¨¡å¼</strong>æ—¶ï¼Œéœ€è¦å¼ºåˆ¶ä½¿ç”¨ <code>action</code>ï¼Œå‚è§ <code>enforceActions</code>ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;configure&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å…è®¸åœ¨åŠ¨ä½œå¤–éƒ¨ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">configure(&#123;<span class="attr">enforceActions</span>: <span class="string">&quot;observed&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="enforceActions"><a href="#enforceActions" class="headerlink" title="enforceActions"></a><code>enforceActions</code></h4><p>ä¹Ÿè¢«ç§°ä¸ºâ€œä¸¥æ ¼æ¨¡å¼â€ã€‚</p>
<p>åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸å…è®¸åœ¨ <a target="_blank" rel="noopener" href="https://cn.mobx.js.org/refguide/action.html"><code>action</code></a> å¤–æ›´æ”¹ä»»ä½•çŠ¶æ€ã€‚ å¯æ¥æ”¶çš„å€¼:</p>
<ul>
<li><code>&quot;never&quot;</code> (é»˜è®¤): å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä¿®æ”¹çŠ¶æ€</li>
<li><code>&quot;observed&quot;</code>: åœ¨æŸå¤„è§‚å¯Ÿåˆ°çš„æ‰€æœ‰çŠ¶æ€éƒ½éœ€è¦é€šè¿‡åŠ¨ä½œè¿›è¡Œæ›´æ”¹ã€‚åœ¨æ­£å¼åº”ç”¨ä¸­æ¨èæ­¤ä¸¥æ ¼æ¨¡å¼ã€‚</li>
<li><code>&quot;always&quot;</code>: çŠ¶æ€å§‹ç»ˆéœ€è¦é€šè¿‡åŠ¨ä½œæ¥æ›´æ–°(å®é™…ä¸Šè¿˜åŒ…æ‹¬åˆ›å»º)ã€‚</li>
</ul>
<h3 id="lesson3-ç»™ç»„ä»¶æ·»åŠ å“åº”å¼"><a href="#lesson3-ç»™ç»„ä»¶æ·»åŠ å“åº”å¼" class="headerlink" title="lesson3-ç»™ç»„ä»¶æ·»åŠ å“åº”å¼"></a>lesson3-ç»™ç»„ä»¶æ·»åŠ å“åº”å¼</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gijayj5424j30z80u07wh.jpg" alt="image-20200908160328366"></p>
<p>ç»™ç»„ä»¶æ·»åŠ å“åº”å¼æœ‰ä»¥ä¸‹ä¸‰ç§åŠæ³•ï¼š</p>
<p>ğŸ˜ <a target="_blank" rel="noopener" href="https://mobx-react.js.org/observer-hoc">observer HOC</a></p>
<p>ğŸ¤“ <a target="_blank" rel="noopener" href="https://mobx-react.js.org/observer-component">observer component</a></p>
<p>ğŸ§ <a target="_blank" rel="noopener" href="https://mobx-react.js.org/observer-hook">useObserver hook</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Observer, useObserver, observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = observable(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// named function is optional (for debugging purposes)</span></span><br><span class="line"><span class="keyword">const</span> P1 = observer(<span class="function"><span class="keyword">function</span> <span class="title">P1</span>(<span class="params">&#123; person &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P2 = <span class="function">(<span class="params">&#123; person &#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P3 = <span class="function">(<span class="params">&#123; person &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">P1</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">P2</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">P3</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  person.name = <span class="string">&#x27;Jane&#x27;</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>



<h5 id="observer-HOC"><a href="#observer-HOC" class="headerlink" title="observer HOC"></a>observer HOC</h5><p>æ³¨æ„ï¼šmobx-reactä¸mobx-react-liteä¸­éƒ½æœ‰observerï¼Œä½†æ˜¯åè€…ä¸æ”¯æŒç±»ç»„ä»¶ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å‚æ•°ï¼Œå¦‚æœç»„ä»¶æ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨optionsï¼Œç±»ç»„ä»¶åˆ™æ²¡æœ‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">observer&lt;P&gt;(baseComponent: React.FC&lt;P&gt;, options?: IObserverOptions): React.FC&lt;P&gt;</span><br><span class="line"></span><br><span class="line">interface IObserverOptions &#123;</span><br><span class="line">    // Pass true to use React.forwardRef over the inner component. It&#x27;s false by the default.</span><br><span class="line">    forwardRef?: boolean</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>observeræŠŠç»„ä»¶è½¬æ¢æˆå“åº”å¼ç»„ä»¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è¿½è¸ªå“ªä¸ªå¯è§‚å¯Ÿé‡è¢«ä½¿ç”¨äº†ä»¥åŠå½“å€¼æ”¹å˜çš„æ—¶å€™è‡ªåŠ¨é‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observer, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Counter = observer&lt;Props&gt;(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> store = useLocalStore(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: props.initialCount,</span><br><span class="line">    <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      store.count += <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;store.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;store.inc&#125;</span>&gt;</span>Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>observerå†…éƒ¨ä½¿ç”¨äº†React.memoï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ä¸ç”¨è‡ªå·±å†å°è£…memoï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œobserverå†…éƒ¨å°è£…çš„memoåªè´Ÿè´£é»˜è®¤çš„æµ…æ¯”è¾ƒï¼Œå› ä¸ºmobx-reactè®¤ä¸ºï¼Œobservedç»„ä»¶å¾ˆå°‘éœ€è¦åŸºäºå¤æ‚çš„propsè¿›è¡Œæ›´æ–°æ¸²æŸ“ã€‚ä»¥ä¸‹æ˜¯mobx-react-liteä¸­çš„æºç éƒ¨åˆ†æˆªå›¾ï¼Œå‚è€ƒè¡Œ61-63çš„æ³¨é‡Šã€‚</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gircs01emmj30ut0u0e81.jpg" alt="image-20200915151056480" style="zoom:50%;" />



<h5 id="Observer-component"><a href="#Observer-component" class="headerlink" title="Observer component"></a>Observer component</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Observer&gt;&#123;renderFn&#125;&lt;/Observer&gt;</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶ä¸€ä¸ªåŒ¿åæ— å‚æ•°çš„å‡½æ•°ä½œä¸ºchildrenï¼Œå¹¶ä¸”è¿”å›Reactå…ƒç´ ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observer, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ObservePerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> person = useLocalStore(<span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span> &#125;))</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;person.name&#125; <span class="tag">&lt;<span class="name">i</span>&gt;</span>I will never change my name<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> (person.name = &#x27;Mike&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">          I want to be Mike</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåªèƒ½ä½¿å¾—å®ƒè‡ªå·±çš„è¿”å›ç»„ä»¶æ˜¯å“åº”å¼çš„ï¼Œå¦‚æœä½ é‡Œé¢è¿˜åµŒå¥—äº†åˆ«çš„ç»„ä»¶ï¼Œé‚£è¿™ä¸ªé‡Œé¢çš„ç»„ä»¶å¾—é è‡ªå·±å˜æˆå“åº”å¼~</p>
<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObservePerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;() =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">GetStore</span>&gt;</span>&#123;store =&gt; <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;self&quot;</span>&gt;</span>&#123;store.wontSeeChangesToThis&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">GetStore</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­é‡Œï¼Œè¿™ä¸ªclassNameä¸ºdivå°±ä¸æ˜¯å“åº”å¼ï¼Œå¦‚æœæƒ³å˜æˆå“åº”å¼ï¼Œéœ€è¦å†é¢å¤–æ·»åŠ ï¼Œæ¯”å¦‚è¯´åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObservePerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">GetStore</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;store =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;store.changesAreSeenAgain&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">GetStore</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="useObserver-hook"><a href="#useObserver-hook" class="headerlink" title="useObserver hook"></a>useObserver hook</h5><p>å‡½æ•°ç­¾åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useObserver&lt;T&gt;(fn: () =&gt; T, baseComponentName = &quot;observed&quot;, options?: IUseObserverOptions): T</span><br><span class="line"></span><br><span class="line">interface IUseObserverOptions &#123;</span><br><span class="line">    // optional custom hook that should make a component re-render (or not) upon changes</span><br><span class="line">    useForceUpdate: () =&gt; () =&gt; void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™ä¸ªè‡ªå®šä¹‰hookæ–¹æ³•åªå­˜åœ¨äºmobx-react-liteï¼Œæˆ–è€…æ˜¯mobx-react@6ã€‚</p>
<p>è¿™ä¸ªhookæ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç»„ä»¶å˜å¾—å“åº”å¼ï¼Œä½†æ˜¯å…³äºä¸€äº›ä¼˜åŒ–å…¼å®¹æ‰‹æ®µå¦‚memoæˆ–è€…forwardRefï¼Œåˆ™éœ€è¦ä½ è‡ªå·±æ‰‹åŠ¨æ·»åŠ ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useObserver, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x or mobx-react-lite@1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> person = useLocalStore(<span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span> &#125;))</span><br><span class="line">  <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;person.name&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> (person.name = &#x27;Mike&#x27;)&#125;&gt;No! I am Mike<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  ))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªä¼˜ç‚¹ï¼Œå°±æ˜¯ä»»ä½•çš„hookæ”¹å˜observableï¼Œç»„ä»¶éƒ½ä¸ä¼šé‡å¤æ¸²æŸ“ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å°±ç®—ä½ æ˜¯åœ¨ç»„ä»¶çš„æŸä¸€éƒ¨åˆ†ä½¿ç”¨ï¼Œä½†æ˜¯å´èƒ½å¼•èµ·ç»„ä»¶çš„å…¨éƒ¨æ›´æ–°~ï¼Œæ‰€ä»¥æ…ç”¨ï¼Œå¦‚æœæƒ³è¦ç²¾ç»†æ§åˆ¶çš„è¯ï¼Œè¿˜æ˜¯è¦é€‰æ‹©<Observer/>æˆ–è€…useForceUpdateã€‚</p>
<h3 id="lesson4-Mange-state-çŠ¶æ€ç®¡ç†"><a href="#lesson4-Mange-state-çŠ¶æ€ç®¡ç†" class="headerlink" title="lesson4-Mange state-çŠ¶æ€ç®¡ç†"></a>lesson4-Mange state-çŠ¶æ€ç®¡ç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLocalStore&lt;T, S&gt;(initializer: () =&gt; T, source?: S): T</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°çš„observable stateå¯ä»¥ä½¿ç”¨useLocalStoreï¼Œä½†æ˜¯è®°ä½ä¸€ç‚¹å°±æ˜¯å¯¹äºæ¯ä¸ªç»„ä»¶å®ä¾‹ï¼ŒuseLocalStoreçš„<strong>åˆå§‹åŒ–å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œå¹¶ä¸”æ˜¯åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œéƒ½æœ‰æ•ˆã€‚</p>
<p>useLocalStoreè¿”å›å¯¹è±¡é‡Œçš„æ‰€æœ‰å±æ€§å€¼éƒ½ä¼šè‡ªåŠ¨è½¬å˜ä¸ºobservableï¼Œæ‰€æœ‰gettersä¼šè¢«è½¬åŒ–ä¸ºcomputedå±æ€§ï¼Œæ‰€æœ‰æ–¹æ³•ä¹Ÿä¼šä¸storeå…³è”ä¸”è‡ªåŠ¨å¼•ç”¨ mobxçš„transactionã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useLocalStore, useObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span> <span class="comment">// 6.x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SmartTodo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> todo = useLocalStore(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Click to toggle&#x27;</span>,</span><br><span class="line">    <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="function"><span class="title">toggle</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      todo.done = !todo.done</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span> <span class="title">emoji</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> todo.done ? <span class="string">&#x27;ğŸ˜œ&#x27;</span> : <span class="string">&#x27;ğŸƒ&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">onClick</span>=<span class="string">&#123;todo.toggle&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;todo.title&#125; &#123;todo.emoji&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  ))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="ä¸è¦è§£æ„"><a href="#ä¸è¦è§£æ„" class="headerlink" title="ä¸è¦è§£æ„"></a>ä¸è¦è§£æ„</h5><p>è§£æ„çš„è¯ï¼Œä¼šç ´åå“åº”å¼ã€‚mobxä¸­çš„observableséƒ½æ˜¯å¯¹è±¡ï¼Œä¸€æ—¦è§£æ„ï¼Œæ‰€æœ‰çš„åŸå§‹å˜é‡éƒ½ä¼šåœç•™åœ¨ä¸Šä¸€ä¸ªå€¼ï¼Œè€Œä¸å†æ˜¯observableäº†ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥å–å€¼todo.titleï¼Œä½†æ˜¯ä¸èƒ½const {title} = todoã€‚</p>
<h5 id="å…³äºå…¨å±€store"><a href="#å…³äºå…¨å±€store" class="headerlink" title="å…³äºå…¨å±€store"></a>å…³äºå…¨å±€store</h5><p>è™½ç„¶useLocalStoreçš„å‘½åå¬ç€åƒæ˜¯åªèƒ½ç”¨åœ¨ç»„ä»¶å†…ï¼Œä½†å®é™…ä¸Šï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨å®ƒå†åŠ ä¸ŠReact Contextæ¥å¤„ç†å…¨å±€çš„storeã€‚</p>
<h3 id="lesson5-å®ç°mobx-react-liteçš„useObserver"><a href="#lesson5-å®ç°mobx-react-liteçš„useObserver" class="headerlink" title="lesson5-å®ç°mobx-react-liteçš„useObserver"></a>lesson5-å®ç°mobx-react-liteçš„useObserver</h3><p>useObserverç®€ç‰ˆå®ç°ä»£ç å¦‚ä¸‹ï¼Œè¯¦ç»†å‚è€ƒgit-lesson5ï¼š<a target="_blank" rel="noopener" href="https://github.com/bubucuo/React-Mobx/tree/lesson5">https://github.com/bubucuo/React-Mobx/tree/lesson5</a></p>
<h5 id="Reaction"><a href="#Reaction" class="headerlink" title="Reaction"></a>Reaction</h5><p>Reactionæ˜¯ä¸€ç§çš„ç‰¹æ®Šçš„è¡ç”Ÿï¼ˆDerivationï¼‰ï¼Œå¯ä»¥æ³¨å†Œå“åº”å‡½æ•°ï¼Œå¦‚å¼ºåˆ¶ç»„ä»¶æ›´æ–°çš„forceUpdateã€‚å¸¸ç”¨äºè§¦å‘å‰¯ä½œç”¨ï¼Œå¦‚æ‰“å°æ—¥å¿—ã€æ›´æ–° DOM æˆ–è€…å‘é€ç½‘ç»œè¯·æ±‚ç­‰ç­‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useRef, useReducer, useEffect&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Reaction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useForceUpdate&#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observerComponentNameFor</span>(<span class="params">baseComponentName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`observer<span class="subst">$&#123;baseComponentName&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useObserver</span>(<span class="params">fn, baseComponentName = <span class="string">&quot;observed&quot;</span>, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// const [, forceUpdate] = useReducer(x =&gt; x + 1, 0);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wantedForceUpdateHook = options.useForceUpdate || useForceUpdate;</span><br><span class="line">  <span class="keyword">const</span> forceUpdate = wantedForceUpdateHook();</span><br><span class="line">  <span class="comment">// ç»„ä»¶æœ‰åˆæ¬¡æ¸²æŸ“å’Œæ›´æ–°ï¼Œé‚£è¿™ä¸ªæ—¶å€™reactionå¾—åšä¸€ä¸ªç¼“å­˜ï¼Œ</span></span><br><span class="line">  <span class="keyword">const</span> reactionTrackingRef = useRef(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!reactionTrackingRef.current) &#123;</span><br><span class="line">    reactionTrackingRef.current = &#123;</span><br><span class="line">      <span class="attr">reaction</span>: <span class="keyword">new</span> Reaction(</span><br><span class="line">        observerComponentNameFor(baseComponentName),</span><br><span class="line">        <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// å“åº”å‡½æ•°ä½¿ç”¨forceUpdate</span></span><br><span class="line">          forceUpdate();</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;reaction&#125; = reactionTrackingRef.current;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// æ¸…ç†reaction</span></span><br><span class="line">      reactionTrackingRef.current.reaction.dispose();</span><br><span class="line">      reactionTrackingRef.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> rendering;</span><br><span class="line"></span><br><span class="line">  reaction.track(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    rendering = fn();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rendering;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="lesson6-å®ç°mobx-react-liteçš„Observerä¸observer"><a href="#lesson6-å®ç°mobx-react-liteçš„Observerä¸observer" class="headerlink" title="lesson6-å®ç°mobx-react-liteçš„Observerä¸observer"></a>lesson6-å®ç°mobx-react-liteçš„Observerä¸observer</h3><p>ä¸¤è€…éƒ½æ˜¯åŸºäºuseObserverå®ç°çš„ã€‚</p>
<p>é¦–å…ˆæ˜¯Observer Componentï¼ŒæŠŠchildrenæˆ–è€…renderä½œä¸ºuseObserverçš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå‡½æ•°è¿”å›å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useObserver&#125; <span class="keyword">from</span> <span class="string">&quot;./useObserver&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObserverComponent</span>(<span class="params">&#123;children, render&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> component = children || render;</span><br><span class="line">  <span class="keyword">return</span> useObserver(component);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;ObserverComponent <span class="keyword">as</span> Observer&#125;;</span><br></pre></td></tr></table></figure>

<p>mobx-react-liteçš„observeråˆ™æ˜¯ç›¸å½“äºåœ¨useObserverçš„åŸºç¡€ä¸Šå†å°è£…äº†ä¸€å±‚forwardRefå’Œmemoã€‚</p>
<p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;memo, forwardRef&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useObserver&#125; <span class="keyword">from</span> <span class="string">&quot;./useObserver&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">baseComponent, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> realOptions = &#123;</span><br><span class="line">    <span class="attr">forwardRef</span>: <span class="literal">false</span>,</span><br><span class="line">    ...options</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> useWrappedComponent = <span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> useObserver(<span class="function">() =&gt;</span> baseComponent(props, ref));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> memoComponent;</span><br><span class="line">  <span class="keyword">if</span> (realOptions.forwardRef) &#123;</span><br><span class="line">    memoComponent = memo(forwardRef(useWrappedComponent));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    memoComponent = memo(useWrappedComponent);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> memoComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lesson7-è¯¦è§£mobx-react-liteçš„useAsObservableSourceçš„ä½¿ç”¨åœºæ™¯åŠå®ç°"><a href="#lesson7-è¯¦è§£mobx-react-liteçš„useAsObservableSourceçš„ä½¿ç”¨åœºæ™¯åŠå®ç°" class="headerlink" title="lesson7-è¯¦è§£mobx-react-liteçš„useAsObservableSourceçš„ä½¿ç”¨åœºæ™¯åŠå®ç°"></a>lesson7-è¯¦è§£mobx-react-liteçš„useAsObservableSourceçš„ä½¿ç”¨åœºæ™¯åŠå®ç°</h3><p><strong><a href="mailto:&#x6d;&#111;&#98;&#x78;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#x2d;&#108;&#x69;&#x74;&#101;&#64;&#49;&#x2e;&#x33;&#46;&#x30;">&#x6d;&#111;&#98;&#x78;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#x2d;&#108;&#x69;&#x74;&#101;&#64;&#49;&#x2e;&#x33;&#46;&#x30;</a></strong></p>
<p>åœ¨ä¸æ”¹å˜åŸå…ˆé€»è¾‘çš„åŸºç¡€ä¸Šä½¿ç”¨mobXã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useAsObservableSource&lt;T&gt;(state: T): T</span><br></pre></td></tr></table></figure>

<h4 id="action"><a href="#action" class="headerlink" title="action"></a>action</h4><p>actionæ¥æ”¶ä¸€ä¸ªå‡½æ•°å¹¶è¿”å›å…·æœ‰åŒæ ·ç­¾åçš„å‡½æ•°ï¼Œä½†æ˜¯ç”¨ <code>transaction</code>ã€<code>untracked</code> å’Œ <code>allowStateChanges</code> åŒ…è£¹èµ·æ¥ï¼Œå°¤å…¶æ˜¯ <code>transaction</code> çš„è‡ªåŠ¨åº”ç”¨ä¼šäº§ç”Ÿå·¨å¤§çš„æ€§èƒ½æ”¶ç›Šï¼Œ åŠ¨ä½œä¼šåˆ†æ‰¹å¤„ç†å˜åŒ–å¹¶åªåœ¨(æœ€å¤–å±‚çš„)åŠ¨ä½œå®Œæˆåé€šçŸ¥è®¡ç®—å€¼å’Œååº”ã€‚ è¿™å°†ç¡®ä¿åœ¨åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œåœ¨åŠ¨ä½œæœŸé—´ç”Ÿæˆçš„ä¸­é—´å€¼æˆ–æœªå®Œæˆçš„å€¼å¯¹åº”ç”¨çš„å…¶ä½™éƒ¨åˆ†æ˜¯ä¸å¯è§çš„ã€‚</p>
<p>å»ºè®®å¯¹ä»»ä½•ä¿®æ”¹ observables æˆ–å…·æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ä½¿ç”¨ <code>(@)action</code> ã€‚ ç»“åˆå¼€å‘è€…å·¥å…·çš„è¯ï¼ŒåŠ¨ä½œè¿˜èƒ½æä¾›éå¸¸æœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, action &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = observable(&#123; <span class="attr">value</span>: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> increment = action(<span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    state.value++</span><br><span class="line">    state.value++</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">increment(state)</span><br></pre></td></tr></table></figure>



<h4 id="runInAction-fn"><a href="#runInAction-fn" class="headerlink" title="runInAction(fn)"></a>runInAction(fn)</h4><p><code>runInAction</code> æ˜¯ä¸ªç®€å•çš„å·¥å…·å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä»£ç å—å¹¶åœ¨(å¼‚æ­¥çš„)åŠ¨ä½œä¸­æ‰§è¡Œã€‚è¿™å¯¹äºå³æ—¶åˆ›å»ºå’Œæ‰§è¡ŒåŠ¨ä½œéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨å¼‚æ­¥è¿‡ç¨‹ä¸­ã€‚<code>runInAction(f)</code> æ˜¯ <code>action(f)()</code> çš„è¯­æ³•ç³–ã€‚å¦‚å‚è€ƒä¸Šé¢actionçš„ä¾‹å­ï¼Œå¦‚æœincrementåªç”¨ä¸€æ¬¡ï¼Œä¸æƒ³å†åˆ›å»ºçš„è¯ï¼Œå°±å¯ä»¥æ¢æˆç”¨ä¸‹é¢çš„runInActionçš„å†™æ³•äº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = observable(&#123; <span class="attr">value</span>: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    state.value++</span><br><span class="line">    state.value++</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å†å‚è€ƒä¸ªå¼‚æ­¥çš„ä¾‹å­ï¼Œä½¿ç”¨async/await + runInActionï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; runInAction, makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    githubProjects = []</span><br><span class="line">    state = <span class="string">&quot;pending&quot;</span> <span class="comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        makeAutoObservable(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">fetchProjects</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.githubProjects = []</span><br><span class="line">        <span class="built_in">this</span>.state = <span class="string">&quot;pending&quot;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> projects = <span class="keyword">await</span> fetchGithubProjectsSomehow()</span><br><span class="line">            <span class="keyword">const</span> filteredProjects = somePreprocessing(projects)</span><br><span class="line">            runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.githubProjects = filteredProjects</span><br><span class="line">                <span class="built_in">this</span>.state = <span class="string">&quot;done&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.state = <span class="string">&quot;error&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="è‡ªå·±æ‰‹åŠ¨å®ç°useAsObservableSource-js"><a href="#è‡ªå·±æ‰‹åŠ¨å®ç°useAsObservableSource-js" class="headerlink" title="è‡ªå·±æ‰‹åŠ¨å®ç°useAsObservableSource.js"></a>è‡ªå·±æ‰‹åŠ¨å®ç°useAsObservableSource.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observable, runInAction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useAsObservableSource</span>(<span class="params">current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [res] = React.useState(<span class="function">() =&gt;</span> observable(current));</span><br><span class="line"></span><br><span class="line">  runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(res, current);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lesson8-å®ç°mobx-react-liteçš„useLocalStore"><a href="#lesson8-å®ç°mobx-react-liteçš„useLocalStore" class="headerlink" title="lesson8-å®ç°mobx-react-liteçš„useLocalStore"></a>lesson8-å®ç°mobx-react-liteçš„useLocalStore</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLocalStore&lt;T, S&gt;(initializer: <span class="function">() =&gt;</span> T, source?: S): T</span><br></pre></td></tr></table></figure>



<h4 id="transaction-äº‹åŠ¡"><a href="#transaction-äº‹åŠ¡" class="headerlink" title="transaction(äº‹åŠ¡)"></a>transaction(äº‹åŠ¡)</h4><p><em>transaction æ˜¯åº•å±‚ APIï¼Œåœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ action æˆ– runInAction ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©</em></p>
<p><code>transaction(worker: () =&gt; void)</code> å¯ä»¥ç”¨æ¥æ‰¹é‡æ›´æ–°ï¼Œåœ¨äº‹åŠ¡ç»“æŸå‰ä¸ä¼šé€šçŸ¥ä»»ä½•è§‚å¯Ÿè€…ã€‚ <code>transaction</code> æ¥æ”¶ä¸€ä¸ªæ— å‚æ•°çš„ <code>worker</code> å‡½æ•°ä½œä¸ºå‚æ•°å¹¶è¿è¡Œå®ƒã€‚ è¿™ä¸ªå‡½æ•°å®Œæˆè¿è¡Œå‰ä¸ä¼šé€šçŸ¥ä»»ä½•è§‚å¯Ÿè€…ã€‚ <code>transaction</code> è¿”å› <code>worker</code> å‡½æ•°è¿”å›çš„ä»»ä½•å€¼ã€‚ æ³¨æ„ <code>transaction</code> å®Œå…¨æ˜¯åŒæ­¥è¿è¡Œçš„ã€‚ Transactions å¯ä»¥åµŒå¥—ã€‚åªæœ‰åœ¨å®Œæˆæœ€å¤–é¢çš„ <code>transaction</code> åï¼Œå…¶ä»–ç­‰å¾…çš„ reaction æ‰ä¼šè¿è¡Œã€‚</p>
<h4 id="å®ç°useLocalStore"><a href="#å®ç°useLocalStore" class="headerlink" title="å®ç°useLocalStore"></a>å®ç°useLocalStore</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observable, runInAction, transaction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useAsObservableSource&#125; <span class="keyword">from</span> <span class="string">&quot;./useAsObservableSource&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useLocalStore</span>(<span class="params">initializer, current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> source = useAsObservableSource(current);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> React.useState(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> local = observable(initializer(source));</span><br><span class="line">    runInAction(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.keys(local).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> value = local[key];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          local[key] = wrapInTransaction(value, local);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> local;</span><br><span class="line">  &#125;)[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapInTransaction</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> transaction(<span class="function">() =&gt;</span> fn.apply(context, args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><p>æ³¨æ„ï¼šuseObserverèƒ½å¼•èµ·ç»„ä»¶çš„æ•´ä½“æ¸²æŸ“ï¼Œå¦‚æœæƒ³è¦å±€éƒ¨æ§åˆ¶çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Observer Componentã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  useLocalStore,</span><br><span class="line">  useObserver,</span><br><span class="line">  useAsObservableSource,</span><br><span class="line">  Observer</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../k-mobx-react-lite/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseLocalStore</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;sss&quot;</span>); <span class="comment">//sy-log</span></span><br><span class="line">  <span class="keyword">const</span> newProps = &#123;...props&#125;; <span class="comment">// useAsObservableSource(props);</span></span><br><span class="line">  <span class="comment">// useLocalStoreç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½æ˜¯æœ‰æ•ˆçš„</span></span><br><span class="line">  <span class="keyword">const</span> countStore = useLocalStore(</span><br><span class="line">    <span class="function"><span class="params">newProps</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">count</span>: props.init === <span class="literal">undefined</span> ? <span class="number">0</span> : props.init,</span><br><span class="line">      <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = <span class="built_in">this</span>.count + <span class="number">1</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">get</span> <span class="title">emoji</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.count % <span class="number">2</span> ? <span class="string">&quot;ğŸ˜œ&quot;</span> : <span class="string">&quot;ğŸƒ&quot;</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">get</span> <span class="title">specialNum</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> newProps.init &gt; -<span class="number">1</span> &amp;&amp; newProps.init &lt; <span class="number">10</span></span><br><span class="line">          ? <span class="string">&quot;0&quot;</span> + newProps.init</span><br><span class="line">          : newProps.init;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    newProps</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// return useObserver(() =&gt; (</span></span><br><span class="line">  <span class="comment">//   &lt;div className=&quot;border&quot;&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;h3&gt;UseLocalStore&lt;/h3&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;button onClick=&#123;countStore.add&#125;&gt;count: &#123;countStore.count&#125;&lt;/button&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;p&gt;&#123;countStore.emoji&#125;&lt;/p&gt;</span></span><br><span class="line">  <span class="comment">//     &lt;p&gt;&#123;countStore.specialNum&#125;&lt;/p&gt;</span></span><br><span class="line">  <span class="comment">//   &lt;/div&gt;</span></span><br><span class="line">  <span class="comment">// ));</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å±€éƒ¨æ§åˆ¶</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;() =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;border&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">h3</span>&gt;</span>UseLocalStore<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;countStore.add&#125;</span>&gt;</span>count: &#123;countStore.count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;countStore.emoji&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;countStore.specialNum&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UseLocalStore;</span><br></pre></td></tr></table></figure>





<h3 id="lesson9-å®ç°mobx-reactçš„observer"><a href="#lesson9-å®ç°mobx-reactçš„observer" class="headerlink" title="lesson9-å®ç°mobx-reactçš„observer"></a>lesson9-å®ç°mobx-reactçš„observer</h3><p>mobx-react@6ä»¥åï¼Œmobx-reactçš„observerä¸­ä¼šåˆ¤æ–­ä¸‹æ˜¯å¦æ˜¯å‡½æ•°ç»„ä»¶ï¼Œå¦‚æœæ˜¯å‡½æ•°ç»„ä»¶ï¼Œåˆ™ç”¨çš„è¿˜æ˜¯mobx-react-liteä¸­çš„observerï¼Œå¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œåˆ™è°ƒç”¨makeClassComponentObserverã€‚</p>
<p>æ³¨æ„åŒºåˆ†ï¼šç›®å‰<a href="mailto:&#x6d;&#x6f;&#x62;&#x78;&#45;&#114;&#x65;&#x61;&#x63;&#116;&#x2d;&#x6c;&#105;&#116;&#x65;&#64;&#x32;&#46;&#x32;">&#x6d;&#x6f;&#x62;&#x78;&#45;&#114;&#x65;&#x61;&#x63;&#116;&#x2d;&#x6c;&#105;&#116;&#x65;&#64;&#x32;&#46;&#x32;</a>ä¸­çš„observeræœ‰forwardRefé…ç½®é¡¹ï¼Œä½†æ˜¯ç›®å‰<a href="mailto:&#x6d;&#x6f;&#98;&#120;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#64;&#x36;&#x2e;&#51;&#46;&#x30;">&#x6d;&#x6f;&#98;&#120;&#x2d;&#x72;&#101;&#97;&#99;&#x74;&#64;&#x36;&#x2e;&#51;&#46;&#x30;</a>ä¸æ”¯æŒï¼Œéœ€è¦è‡ªå·±é…ç½®ã€‚</p>
<p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<h4 id="observer"><a href="#observer" class="headerlink" title="observer"></a>observer</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;observer <span class="keyword">as</span> observerLite, Observer&#125; <span class="keyword">from</span> <span class="string">&quot;../k-mobx-react-lite/&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;makeClassComponentObserver&#125; <span class="keyword">from</span> <span class="string">&quot;./observerClass&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">component, options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// forwardRef</span></span><br><span class="line">  <span class="keyword">if</span> (component[<span class="string">&quot;$$typeof&quot;</span>] === <span class="built_in">Symbol</span>.for(<span class="string">&quot;react.forward_ref&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> baseRender = component[<span class="string">&quot;render&quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> React.forwardRef(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Observer</span>&gt;</span>&#123;() =&gt; baseRender.apply(undefined, args)&#125;<span class="tag">&lt;/<span class="name">Observer</span>&gt;</span></span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‡½æ•°ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    (<span class="keyword">typeof</span> component === <span class="string">&quot;function&quot;</span> &amp;&amp; !component.prototype) ||</span><br><span class="line">    !component.prototype.render</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> observerLite(component, options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç±»ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">return</span> makeClassComponentObserver(component);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="makeClassComponentObserver"><a href="#makeClassComponentObserver" class="headerlink" title="makeClassComponentObserver"></a>makeClassComponentObserver</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Reaction&#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">makeClassComponentObserver</span>(<span class="params">componentClass</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> target = componentClass.prototype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> baseRender = target.render;</span><br><span class="line">  target.render = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> makeComponentReactive.call(<span class="built_in">this</span>, baseRender);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> componentClass;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeComponentReactive</span>(<span class="params">render</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> baseRender = render.bind(<span class="built_in">this</span>);</span><br><span class="line">  <span class="keyword">let</span> isRenderingPending = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> reaction = <span class="keyword">new</span> Reaction(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.constructor.name&#125;</span>.render`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isRenderingPending) &#123;</span><br><span class="line">      isRenderingPending = <span class="literal">true</span>;</span><br><span class="line">      Component.prototype.forceUpdate.call(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.render = reactiveRender;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reactiveRender</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    isRenderingPending = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> rendering = <span class="literal">undefined</span>;</span><br><span class="line">    reaction.track(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      rendering = baseRender();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rendering;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> reactiveRender.call(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lesson10-mobx-reactçš„Providerã€injectçš„ä½¿ç”¨"><a href="#lesson10-mobx-reactçš„Providerã€injectçš„ä½¿ç”¨" class="headerlink" title="lesson10-mobx-reactçš„Providerã€injectçš„ä½¿ç”¨"></a>lesson10-mobx-reactçš„Providerã€injectçš„ä½¿ç”¨</h3><p><code>Provider</code>æ˜¯ä¸ªèƒ½å¤Ÿä¼ é€’storeçš„ç»„ä»¶ï¼Œä¹Ÿæ”¯æŒä¼ é€’å…¶ä»–éstoreæ•°æ®ï¼Œå…¶å®ç°æœºåˆ¶å°±æ˜¯Reactçš„Contextè·¨å±‚çº§ä¼ é€’ã€‚å¦‚æœä½ æœ‰ä¸€äº›éœ€è¦è·¨å±‚çº§æ•°æ®éœ€è¦ä¼ é€’ï¼Œå¯ä»¥è€ƒè™‘ä¸‹è¿™ä¸ªç»„ä»¶ã€‚</p>
<p><code>inject</code>å¯ä»¥ç”¨äºæå–ä½ ä¼ è¾“çš„æ•°æ®çš„storeï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆhocï¼‰ã€‚</p>
<p>å‚è€ƒä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@inject(<span class="string">&quot;color&quot;</span>)</span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">background:</span> <span class="attr">this.props.color</span> &#125;&#125;&gt;</span>&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> children = <span class="built_in">this</span>.props.messages.map(<span class="function"><span class="params">message</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Message</span> <span class="attr">text</span>=<span class="string">&#123;message.text&#125;</span> /&gt;</span></span>)</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>è¯»å–Provideræä¾›çš„æ•°æ®ä¸æ˜¯éå¾—ç”¨injectï¼Œç”¨React.useContext(MobXProviderContext)ä¹Ÿå¯ä»¥ï¼ŒMobXProviderContextæ¥è‡ªmobx-reactã€‚</li>
<li>ä½¿ç”¨injectå’Œobserverçš„æ—¶å€™ï¼Œæ³¨æ„é¡ºåºï¼Œobserveråº”è¯¥æ˜¯å†…éƒ¨ï¼Œinjectåœ¨å¤–é¢ã€‚</li>
</ul>
<h3 id="lesson11-å®ç°mobx-reactçš„Providerã€inject"><a href="#lesson11-å®ç°mobx-reactçš„Providerã€inject" class="headerlink" title="lesson11-å®ç°mobx-reactçš„Providerã€inject"></a>lesson11-å®ç°mobx-reactçš„Providerã€inject</h3><p>ProvideråŸºäºContextä¸ç»„ä»¶å¤åˆ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useRef, useContext&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;MobXProviderContext&#125; <span class="keyword">from</span> <span class="string">&quot;./MobXProviderContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">&#123;children, ...stores&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> parentValue = useContext(MobXProviderContext);</span><br><span class="line">  <span class="keyword">const</span> mutableProvdierRef = useRef(&#123;...parentValue, ...stores&#125;);</span><br><span class="line">  <span class="keyword">const</span> value = mutableProvdierRef.current;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">MobXProviderContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">MobXProviderContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>injectåŸºäºé«˜é˜¶ç»„ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useContext&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;MobXProviderContext&#125; <span class="keyword">from</span> <span class="string">&quot;./MobXProviderContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> inject = <span class="function">(<span class="params">...storeNames</span>) =&gt;</span> <span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> Injector = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = useContext(MobXProviderContext);</span><br><span class="line">    <span class="keyword">const</span> newProps = &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      ...context</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (ref) &#123;</span><br><span class="line">      newProps.ref = ref;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(component, newProps);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Injector;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h3 id="lesson12-å®ç°mobxçš„observable"><a href="#lesson12-å®ç°mobxçš„observable" class="headerlink" title="lesson12-å®ç°mobxçš„observable"></a>lesson12-å®ç°mobxçš„observable</h3><p>MobX ä¸ºç°æœ‰çš„æ•°æ®ç»“æ„(å¦‚å¯¹è±¡ï¼Œæ•°ç»„å’Œç±»å®ä¾‹)æ·»åŠ äº†å¯è§‚å¯Ÿçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ observableå°±å¯ä»¥ç®€å•åœ°å®Œæˆè¿™ä¸€åˆ‡ã€‚</p>
<p>Observable å€¼å¯ä»¥æ˜¯JSåŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨ç±»å‹ã€æ™®é€šå¯¹è±¡ã€ç±»å®ä¾‹ã€æ•°ç»„å’Œæ˜ å°„ã€‚</p>
<h4 id="å®ç°observable"><a href="#å®ç°observable" class="headerlink" title="å®ç°observable"></a>å®ç°observable</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> observable = assign(createObservable, observableFactories)</span><br></pre></td></tr></table></figure>



<h4 id="å®ç°extendObservable"><a href="#å®ç°extendObservable" class="headerlink" title="å®ç°extendObservable"></a>å®ç°extendObservable</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extendObservable(target, properties, decorators?, options?)</span><br></pre></td></tr></table></figure>

<p>extendObservableç”¨æ¥å‘å·²å­˜åœ¨çš„ç›®æ ‡å¯¹è±¡æ·»åŠ  observable å±æ€§ã€‚ å±æ€§æ˜ å°„ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šå¯¼è‡´ç›®æ ‡ä¸Šçš„æ–°çš„ observable å±æ€§è¢«åˆå§‹åŒ–ä¸ºç»™å®šå€¼ã€‚ å±æ€§æ˜ å°„ä¸­çš„ä»»æ„ getters éƒ½ä¼šè½¬åŒ–æˆè®¡ç®—å±æ€§ã€‚</p>
<p><code>decorators</code> å‚æ•°ç”¨æ¥é‡è½½ç”¨äºæŒ‡å®šå±æ€§çš„è£…é¥°å™¨ï¼Œç±»ä¼¼äº <code>decorate</code> å’Œ <code>observable.object</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;asObservableObject&#125; <span class="keyword">from</span> <span class="string">&quot;./observableObject&quot;</span>;</span><br><span class="line"><span class="comment">// import &#123;makeProperty&#125; from &quot;./makeObservable&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">extendObservable</span>(<span class="params">target, props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// step1</span></span><br><span class="line">  <span class="keyword">const</span> adm = asObservableObject(target);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// step2</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(props).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// makeProperty(adm, target, key, props[key]);</span></span><br><span class="line">    adm.addObservableProp_(key, props[key]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



























<p>ä¸observableæ— ä¾èµ–å…³ç³»</p>
<p>æœ¬åœ°çš„observable stateå¯ä»¥ä½¿ç”¨useLocalStoreï¼Œä½†æ˜¯è®°ä½ä¸€ç‚¹å°±æ˜¯å¯¹äºæ¯ä¸ªç»„ä»¶å®ä¾‹ï¼ŒuseLocalStoreçš„<strong>åˆå§‹åŒ–å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œå¹¶ä¸”æ˜¯åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œéƒ½æœ‰æ•ˆã€‚</p>
<p>useLocalStoreæ”¯æŒä½ ä¼ é€’ä¸€ä¸ªéobservableçš„plain objectä½œä¸ºç¬¬äºŒä¸ªå‚æ•°å­˜åœ¨è¿™ä¸ªstoreçš„è¡ç”Ÿé‡Œï¼Œå®ƒå¯ä»¥æ˜¯propsã€useContextç”šè‡³æ˜¯useReducerã€‚å½“ç„¶ï¼Œè¿™ä¸ªå‚æ•°å¿…é¡»å¾—å§‹ç»ˆä¿æŒä¸€ç§ç»“æ„ï¼Œä¸èƒ½ç”¨åœ¨æ¡ä»¶è¯­å¥ä¸­ã€‚</p>
<p>æ³¨ï¼šuseLocalStoreä¸useAsObservableSourceçš„åŒºåˆ«åœ¨äºåè€…åªèƒ½ç”¨äºobjectï¼Œå¦‚æœä½ ä¸éœ€è¦actionå’Œcomputedå±æ€§ï¼Œé‚£å®Œå…¨å¯ä»¥ä½¿ç”¨åè€…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import &#123; observer, useLocalStore &#125; from &#x27;mobx-react&#x27; // 6.x</span><br><span class="line"></span><br><span class="line">export const Counter = observer(props =&gt; &#123;</span><br><span class="line">  const store = useLocalStore(</span><br><span class="line">    // don&#x27;t ever destructure source, it won&#x27;t work</span><br><span class="line">    source =&gt; (&#123;</span><br><span class="line">      count: props.initialCount,</span><br><span class="line">      get multiplied() &#123;</span><br><span class="line">        // you shouldn&#x27;t ever refer to props directly here, it won&#x27;t see a change</span><br><span class="line">        return source.multiplier * store.count</span><br><span class="line">      &#125;,</span><br><span class="line">      inc() &#123;</span><br><span class="line">        store.count += 1</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    props, // note props passed here</span><br><span class="line">  )</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;button id=&quot;inc&quot; onClick=&#123;store.inc&#125;&gt;</span><br><span class="line">        &#123;`Count: $&#123;store.count&#125;`&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;span&gt;&#123;store.multiplied&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="lesson-13mobxä¸redux"><a href="#lesson-13mobxä¸redux" class="headerlink" title="lesson-13mobxä¸redux"></a>lesson-13mobxä¸redux</h3><h4 id="mobx"><a href="#mobx" class="headerlink" title="mobx"></a>mobx</h4><p>å®ƒé€šè¿‡é€æ˜çš„å‡½æ•°å“åº”å¼ç¼–ç¨‹(transparently applying functional reactive programming - TFRP)ä½¿å¾—çŠ¶æ€ç®¡ç†å˜å¾—ç®€å•å’Œå¯æ‰©å±•ã€‚MobXèƒŒåçš„å“²å­¦å¾ˆç®€å•:</p>
<p><em>ä»»ä½•æºè‡ªåº”ç”¨çŠ¶æ€çš„ä¸œè¥¿éƒ½åº”è¯¥è‡ªåŠ¨åœ°è·å¾—ã€‚</em></p>
<p><img src="https://cn.mobx.js.org/flow.png" alt="MobX unidirectional flow"></p>
<h4 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h4><p>Redux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybply1gc57dy6j70j31240netja.jpg" alt="image-20200222151958879"></p>
<p>Redux é™¤äº†å’Œ <a target="_blank" rel="noopener" href="https://facebook.github.io/react/">React</a> ä¸€èµ·ç”¨å¤–ï¼Œè¿˜æ”¯æŒå…¶å®ƒç•Œé¢åº“ã€‚ å®ƒä½“å°ç²¾æ‚ï¼ˆåªæœ‰2kBï¼ŒåŒ…æ‹¬ä¾èµ–ï¼‰ã€‚</p>
<p>åº”ç”¨ä¸­æ‰€æœ‰çš„ state éƒ½ä»¥ä¸€ä¸ªå¯¹è±¡æ ‘çš„å½¢å¼å‚¨å­˜åœ¨ä¸€ä¸ªå•ä¸€çš„ <em>store</em> ä¸­ã€‚ æƒŸä¸€æ”¹å˜ state çš„åŠæ³•æ˜¯è§¦å‘ <em>action</em>ï¼Œä¸€ä¸ªæè¿°å‘ç”Ÿä»€ä¹ˆçš„å¯¹è±¡ã€‚ ä¸ºäº†æè¿° action å¦‚ä½•æ”¹å˜ state æ ‘ï¼Œä½ éœ€è¦ç¼–å†™ <em>reducers</em>ã€‚</p>
<h5 id="reduxä¸‰å¤§åŸåˆ™"><a href="#reduxä¸‰å¤§åŸåˆ™" class="headerlink" title="reduxä¸‰å¤§åŸåˆ™"></a>reduxä¸‰å¤§åŸåˆ™</h5><h6 id="å•ä¸€æ•°æ®æº"><a href="#å•ä¸€æ•°æ®æº" class="headerlink" title="å•ä¸€æ•°æ®æº"></a>å•ä¸€æ•°æ®æº</h6><p>æ•´ä¸ªåº”ç”¨çš„ state è¢«å‚¨å­˜åœ¨ä¸€æ£µ object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª store ä¸­ã€‚</p>
<h6 id="State-æ˜¯åªè¯»çš„"><a href="#State-æ˜¯åªè¯»çš„" class="headerlink" title="State æ˜¯åªè¯»çš„"></a>State æ˜¯åªè¯»çš„</h6><p>å”¯ä¸€æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯è§¦å‘ actionï¼Œaction æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚</p>
<h6 id="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹"><a href="#ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹" class="headerlink" title="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹"></a>ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹</h6><p>ä¸ºäº†æè¿° action å¦‚ä½•æ”¹å˜ state tree ï¼Œä½ éœ€è¦ç¼–å†™ reducersã€‚</p>
<h4 id="ä¸åŒ"><a href="#ä¸åŒ" class="headerlink" title="ä¸åŒ"></a>ä¸åŒ</h4><h5 id="è®¾è®¡æ€æƒ³ä¸åŒ"><a href="#è®¾è®¡æ€æƒ³ä¸åŒ" class="headerlink" title="è®¾è®¡æ€æƒ³ä¸åŒ"></a>è®¾è®¡æ€æƒ³ä¸åŒ</h5><p>Reduxéµå¾ªå‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programming, FPï¼‰æ€æƒ³ï¼Œè€ŒMobXè®¾è®¡æ›´å¤šåå‘äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰å’Œå“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰ï¼ŒMobXä¸­å°†çŠ¶æ€åŒ…è£…æˆå¯è§‚å¯Ÿå¯¹è±¡ï¼Œå†ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡çš„æ‰€æœ‰èƒ½åŠ›ï¼Œä¸€æ—¦çŠ¶æ€å¯¹è±¡å˜æ›´ï¼Œæ›´æ–°å°±èƒ½è¢«è‡ªåŠ¨è·å¾—ã€‚</p>
<h5 id="å¯¹storeç®¡ç†çš„ä¸åŒ"><a href="#å¯¹storeç®¡ç†çš„ä¸åŒ" class="headerlink" title="å¯¹storeç®¡ç†çš„ä¸åŒ"></a>å¯¹storeç®¡ç†çš„ä¸åŒ</h5><p>åœ¨Reduxåº”ç”¨ä¸­ï¼Œæ‰€æœ‰å…±äº«çš„åº”ç”¨æ•°æ®éƒ½é›†ä¸­åœ¨ä¸€ä¸ªå¤§çš„storeä¸­ï¼Œè€ŒMboXåˆ™é€šå¸¸æŒ‰æ¨¡å—å°†åº”ç”¨çŠ¶æ€åˆ’åˆ†ï¼Œåœ¨å¤šä¸ªç‹¬ç«‹çš„storeä¸­ç®¡ç†ã€‚</p>
<h5 id="å·¥ä½œæ–¹å¼ä¸åŒ"><a href="#å·¥ä½œæ–¹å¼ä¸åŒ" class="headerlink" title="å·¥ä½œæ–¹å¼ä¸åŒ"></a>å·¥ä½œæ–¹å¼ä¸åŒ</h5><p>Reduxä¸­ç”¨jså¯¹è±¡å­˜å‚¨çŠ¶æ€æ•°æ®ï¼Œå¹¶ä¸”æ‰‹åŠ¨è¿½è¸ªçŠ¶æ€å˜æ›´ï¼Œè€ŒMobXä¸­ä¼šæŠŠçŠ¶æ€æ•°æ®è½¬åŒ–ä¸ºå¯è§‚å¯Ÿçš„å¯¹è±¡ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œè‡ªåŠ¨è§¦å‘ç›‘å¬ã€‚</p>
<h5 id="çŠ¶æ€ä¿®æ”¹æ–¹å¼"><a href="#çŠ¶æ€ä¿®æ”¹æ–¹å¼" class="headerlink" title="çŠ¶æ€ä¿®æ”¹æ–¹å¼"></a>çŠ¶æ€ä¿®æ”¹æ–¹å¼</h5><p>Reduxä¸­çš„ä¸å¯ä»¥ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œåªèƒ½é€šè¿‡dispatchæ´¾å‘äº‹ä»¶ä¿®æ”¹ï¼Œè€ŒMobXä¸­åˆ™å¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡actionä¿®æ”¹ï¼Œæ¯”è¾ƒâ€çµæ´»â€œï¼Œä½†æ˜¯è¿™ç§çµæ´»ä¸åˆ©äºé¡¹ç›®ç®¡ç†ä¸ç»´æŠ¤ï¼Œå› æ­¤å»ºè®®è¿˜æ˜¯å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä»è€Œç¦æ­¢æ‰ç›´æ¥ä¿®æ”¹çŠ¶æ€çš„æ–¹å¼ï¼Œå¹¶ä¸”åˆ¶å®šçŠ¶æ€ç®¡ç†è§„èŒƒã€‚</p>
<h5 id="ä¸å¯å˜ï¼ˆImmutableï¼‰å’Œå¯å˜ï¼ˆMutableï¼‰"><a href="#ä¸å¯å˜ï¼ˆImmutableï¼‰å’Œå¯å˜ï¼ˆMutableï¼‰" class="headerlink" title="ä¸å¯å˜ï¼ˆImmutableï¼‰å’Œå¯å˜ï¼ˆMutableï¼‰"></a>ä¸å¯å˜ï¼ˆImmutableï¼‰å’Œå¯å˜ï¼ˆMutableï¼‰</h5><p>ReduxçŠ¶æ€å¯¹è±¡é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼ˆImmutableï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨reducersï¼Œå¹¶ä¸”åœ¨åŸæ¥å¯¹è±¡çš„åŸºç¡€ä¸Šè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½å¾ˆæ–¹ä¾¿çš„è¿”å›ä¸Šä¸€ä¸ªçŠ¶æ€ï¼Œä½†æ˜¯MobXä¸­åˆ™å¯ç”±ç›´æ¥ä½¿ç”¨æ–°å€¼æ›´æ–°çŠ¶æ€å¯¹è±¡ã€‚</p>
<h5 id="mobx-reactå’Œreact-reudx"><a href="#mobx-reactå’Œreact-reudx" class="headerlink" title="mobx-reactå’Œreact-reudx"></a>mobx-reactå’Œreact-reudx</h5><p>å„è‡ªéƒ½æœ‰Reactç»‘å®šåº“ï¼Œä¸”ç»‘å®šåº“è®¾è®¡ä¸æ€æƒ³ç›¸ä¼¼ï¼Œreact-reduxä¸­æœ‰Providerä¸connectï¼Œmobx-reactä¸­æœ‰Providerå’Œinjectï¼Œéƒ½æœ‰Contextå’ŒHOCè®¾è®¡ï¼ŒåæœŸéƒ½å¯ä»¥ç”¨hooksä»£æ›¿ã€‚</p>
<h5 id="ä½“ç§¯ä¸åŒ"><a href="#ä½“ç§¯ä¸åŒ" class="headerlink" title="ä½“ç§¯ä¸åŒ"></a>ä½“ç§¯ä¸åŒ</h5><p>Reduxä½“å°ç²¾æ‚ã€å‘¨è¾¹é…åˆåº“éå¸¸ä¸°å¯Œï¼Œå¦‚redux-thunkä¸­é—´ä»¶ç­‰ã€‚mobxåº“åˆ™åŠŸèƒ½å¼ºå¤§ï¼Œè‡ªå·±å°±èƒ½ç‹¬ç«‹å®Œæˆå¾ˆå¤šåŠŸèƒ½ï¼Œå¦‚å¼‚æ­¥ç­‰ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å¦‚æœä½ ä¸æ‡‚Reduxä¸­çš„reducersã€ä¸­é—´ä»¶ç­‰è¿™äº›æ¦‚å¿µï¼Œ<code>MobX</code>å…¥é—¨ä¹Ÿè®¸ç›¸å¯¹ç®€å•ï¼Œæ„å»ºé¡¹ç›®å½“ç„¶ä¹Ÿå¾ˆå¿«ï¼Œä½†æ˜¯å½“é¡¹ç›®è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œå…¶å®éš¾åº¦ä¸ä¼šå¤©å·®åœ°åˆ«ï¼Œéƒ½éœ€è¦å¼€å‘è€…å¯¹åº“æœ¬èº«èƒ½æœ‰æ·±åˆ»çš„ç†è§£ã€‚ç›®å‰æ›´å¤šäººé€‰æ‹©ä½¿ç”¨Reduxï¼Œå°¤å…¶æ˜¯å¤§å‹é¡¹ç›®ï¼Œè€Œé€‰æ‹©MobXçš„åˆ™ä¸­å°å‹é¡¹ç›®å¤šä¸€äº›ï¼ŒMobXå¥½ç†è§£ã€è‡ªç”±ï¼Œè¿™å½“ç„¶æ˜¯ä¸ªä¼˜åŠ¿ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå¸¦æ¥äº†åŠ£åŠ¿ï¼Œè¿‡äºè‡ªç”±å¯¹äºé¡¹ç›®ç®¡ç†å½“ç„¶æ˜¯å·¨å¤§çš„ç¼ºç‚¹ï¼Œå› æ­¤ä½¿ç”¨MobXéœ€è¦å¼€å‘è€…çº¦å®šè§„èŒƒã€‚æ‰€ä»¥ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºï¼Œé€‰æ‹©MobXè¿˜æ˜¯Reduxç”¨äºçŠ¶æ€ç®¡ç†ï¼Œæˆ–è€…ä½ æœ‰ç¬¬ä¸‰ç¬¬å››ä¸ªåˆ«çš„é€‰æ‹©ï¼Œæ ¹æ®è‡ªå·±çš„é¡¹ç›®å’Œä¸ªäººå¯¹äºå„è‡ªåº“çš„æŒæ¡åº¦æ¥åšé€‰æ‹©å°±å¯ä»¥äº†ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">xincheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/11/01/MobX%E6%96%87%E6%A1%A3/">http://example.com/2021/11/01/MobXæ–‡æ¡£/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1638979193&amp;t=85f0a5750ddf5762669a9bf2aaac970b" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/10/08/regular-expression/"><img class="next-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.php.cn%2Fupload%2Farticle%2F000%2F000%2F007%2F2e1367cda06e541fb8d477d250d8daf6.jpg&amp;refer=http%3A%2F%2Fimg.php.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1637719211&amp;t=d4dc21fdbbb8305765f04850f362555e" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">regular-expression</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">xincheng</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SevenWang666" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/sevenw6666@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MobX%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">MobXæ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-number">1.1.</span> <span class="toc-text">èµ„æº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">å…³äºåº“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">1.3.</span> <span class="toc-text">æ­£æ–‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MobX%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">MobXç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.3.2.</span> <span class="toc-text">ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">å…¥é—¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson1-MobX%E8%A6%81%E7%82%B9"><span class="toc-number">1.3.4.</span> <span class="toc-text">lesson1-MobXè¦ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E5%B9%B6%E4%BD%BF%E5%85%B6%E5%8F%AF%E8%A7%82%E5%AF%9F"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">1. å®šä¹‰çŠ¶æ€å¹¶ä½¿å…¶å¯è§‚å¯Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E4%BB%A5%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">2. åˆ›å»ºè§†å›¾ä»¥å“åº”çŠ¶æ€çš„å˜åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9B%B4%E6%94%B9%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">3. æ›´æ”¹çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson2-MobX-API-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.5.</span> <span class="toc-text">lesson2-MobX API æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Observable-state-%E5%8F%AF%E8%A7%82%E5%AF%9F%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">Observable state(å¯è§‚å¯Ÿçš„çŠ¶æ€)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Computed-values-%E8%AE%A1%E7%AE%97%E5%80%BC"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">Computed values(è®¡ç®—å€¼)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reactions-%E5%8F%8D%E5%BA%94"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">Reactions(ååº”)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#React-%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.5.3.1.</span> <span class="toc-text">React ç»„ä»¶</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-reactions"><span class="toc-number">1.3.5.3.2.</span> <span class="toc-text">è‡ªå®šä¹‰ reactions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MobX-%E4%BC%9A%E5%AF%B9%E4%BB%80%E4%B9%88%E4%BD%9C%E5%87%BA%E5%93%8D%E5%BA%94"><span class="toc-number">1.3.5.3.3.</span> <span class="toc-text">MobX ä¼šå¯¹ä»€ä¹ˆä½œå‡ºå“åº”?</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actions-%E5%8A%A8%E4%BD%9C"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">Actions(åŠ¨ä½œ)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enforceActions"><span class="toc-number">1.3.5.5.</span> <span class="toc-text">enforceActions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson3-%E7%BB%99%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="toc-number">1.3.6.</span> <span class="toc-text">lesson3-ç»™ç»„ä»¶æ·»åŠ å“åº”å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#observer-HOC"><span class="toc-number">1.3.6.0.1.</span> <span class="toc-text">observer HOC</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Observer-component"><span class="toc-number">1.3.6.0.2.</span> <span class="toc-text">Observer component</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#useObserver-hook"><span class="toc-number">1.3.6.0.3.</span> <span class="toc-text">useObserver hook</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson4-Mange-state-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.7.</span> <span class="toc-text">lesson4-Mange state-çŠ¶æ€ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E8%A6%81%E8%A7%A3%E6%9E%84"><span class="toc-number">1.3.7.0.1.</span> <span class="toc-text">ä¸è¦è§£æ„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%85%A8%E5%B1%80store"><span class="toc-number">1.3.7.0.2.</span> <span class="toc-text">å…³äºå…¨å±€store</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson5-%E5%AE%9E%E7%8E%B0mobx-react-lite%E7%9A%84useObserver"><span class="toc-number">1.3.8.</span> <span class="toc-text">lesson5-å®ç°mobx-react-liteçš„useObserver</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Reaction"><span class="toc-number">1.3.8.0.1.</span> <span class="toc-text">Reaction</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">1.3.8.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson6-%E5%AE%9E%E7%8E%B0mobx-react-lite%E7%9A%84Observer%E4%B8%8Eobserver"><span class="toc-number">1.3.9.</span> <span class="toc-text">lesson6-å®ç°mobx-react-liteçš„Observerä¸observer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson7-%E8%AF%A6%E8%A7%A3mobx-react-lite%E7%9A%84useAsObservableSource%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.10.</span> <span class="toc-text">lesson7-è¯¦è§£mobx-react-liteçš„useAsObservableSourceçš„ä½¿ç”¨åœºæ™¯åŠå®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#action"><span class="toc-number">1.3.10.1.</span> <span class="toc-text">action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#runInAction-fn"><span class="toc-number">1.3.10.2.</span> <span class="toc-text">runInAction(fn)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0useAsObservableSource-js"><span class="toc-number">1.3.10.3.</span> <span class="toc-text">è‡ªå·±æ‰‹åŠ¨å®ç°useAsObservableSource.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson8-%E5%AE%9E%E7%8E%B0mobx-react-lite%E7%9A%84useLocalStore"><span class="toc-number">1.3.11.</span> <span class="toc-text">lesson8-å®ç°mobx-react-liteçš„useLocalStore</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#transaction-%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.11.1.</span> <span class="toc-text">transaction(äº‹åŠ¡)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0useLocalStore"><span class="toc-number">1.3.11.2.</span> <span class="toc-text">å®ç°useLocalStore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.3.11.3.</span> <span class="toc-text">ä¾‹å­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson9-%E5%AE%9E%E7%8E%B0mobx-react%E7%9A%84observer"><span class="toc-number">1.3.12.</span> <span class="toc-text">lesson9-å®ç°mobx-reactçš„observer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#observer"><span class="toc-number">1.3.12.1.</span> <span class="toc-text">observer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#makeClassComponentObserver"><span class="toc-number">1.3.12.2.</span> <span class="toc-text">makeClassComponentObserver</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson10-mobx-react%E7%9A%84Provider%E3%80%81inject%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.13.</span> <span class="toc-text">lesson10-mobx-reactçš„Providerã€injectçš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson11-%E5%AE%9E%E7%8E%B0mobx-react%E7%9A%84Provider%E3%80%81inject"><span class="toc-number">1.3.14.</span> <span class="toc-text">lesson11-å®ç°mobx-reactçš„Providerã€inject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson12-%E5%AE%9E%E7%8E%B0mobx%E7%9A%84observable"><span class="toc-number">1.3.15.</span> <span class="toc-text">lesson12-å®ç°mobxçš„observable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0observable"><span class="toc-number">1.3.15.1.</span> <span class="toc-text">å®ç°observable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0extendObservable"><span class="toc-number">1.3.15.2.</span> <span class="toc-text">å®ç°extendObservable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lesson-13mobx%E4%B8%8Eredux"><span class="toc-number">1.3.16.</span> <span class="toc-text">lesson-13mobxä¸redux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mobx"><span class="toc-number">1.3.16.1.</span> <span class="toc-text">mobx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redux"><span class="toc-number">1.3.16.2.</span> <span class="toc-text">redux</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#redux%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.16.2.1.</span> <span class="toc-text">reduxä¸‰å¤§åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">1.3.16.2.1.1.</span> <span class="toc-text">å•ä¸€æ•°æ®æº</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#State-%E6%98%AF%E5%8F%AA%E8%AF%BB%E7%9A%84"><span class="toc-number">1.3.16.2.1.2.</span> <span class="toc-text">State æ˜¯åªè¯»çš„</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BA%AF%E5%87%BD%E6%95%B0%E6%9D%A5%E6%89%A7%E8%A1%8C%E4%BF%AE%E6%94%B9"><span class="toc-number">1.3.16.2.1.3.</span> <span class="toc-text">ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.</span> <span class="toc-text">ä¸åŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.1.</span> <span class="toc-text">è®¾è®¡æ€æƒ³ä¸åŒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9store%E7%AE%A1%E7%90%86%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.2.</span> <span class="toc-text">å¯¹storeç®¡ç†çš„ä¸åŒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.3.</span> <span class="toc-text">å·¥ä½œæ–¹å¼ä¸åŒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E4%BF%AE%E6%94%B9%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.16.3.4.</span> <span class="toc-text">çŠ¶æ€ä¿®æ”¹æ–¹å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98%EF%BC%88Immutable%EF%BC%89%E5%92%8C%E5%8F%AF%E5%8F%98%EF%BC%88Mutable%EF%BC%89"><span class="toc-number">1.3.16.3.5.</span> <span class="toc-text">ä¸å¯å˜ï¼ˆImmutableï¼‰å’Œå¯å˜ï¼ˆMutableï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mobx-react%E5%92%8Creact-reudx"><span class="toc-number">1.3.16.3.6.</span> <span class="toc-text">mobx-reactå’Œreact-reudx</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%93%E7%A7%AF%E4%B8%8D%E5%90%8C"><span class="toc-number">1.3.16.3.7.</span> <span class="toc-text">ä½“ç§¯ä¸åŒ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.16.4.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/11/01/MobX%E6%96%87%E6%A1%A3/" title="mobxæ–‡æ¡£"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1e58fcaaf6f6334a2a8e0937e98cf92c_r.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1638979193&amp;t=85f0a5750ddf5762669a9bf2aaac970b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mobxæ–‡æ¡£"/></a><div class="content"><a class="title" href="/2021/11/01/MobX%E6%96%87%E6%A1%A3/" title="mobxæ–‡æ¡£">mobxæ–‡æ¡£</a><time datetime="2021-11-01T00:00:00.000Z" title="Created 2021-11-01 00:00:00">2021-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/08/regular-expression/" title="regular-expression"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.php.cn%2Fupload%2Farticle%2F000%2F000%2F007%2F2e1367cda06e541fb8d477d250d8daf6.jpg&amp;refer=http%3A%2F%2Fimg.php.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1637719211&amp;t=d4dc21fdbbb8305765f04850f362555e" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="regular-expression"/></a><div class="content"><a class="title" href="/2021/10/08/regular-expression/" title="regular-expression">regular-expression</a><time datetime="2021-10-08T00:00:00.000Z" title="Created 2021-10-08 00:00:00">2021-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/25/index/" title="test"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimages.h128.com%2Fupload%2F202002%2F23%2F202002231023110838.jpg%3Fx-oss-process%3Dimage%2Fauto-orient%2C1%2Fresize%2Cm_fill%2Cw_1421%2Ch_888%2Fquality%2Cq_100%2Fformat%2Cjpg&amp;refer=http%3A%2F%2Fimages.h128.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1632491725&amp;t=98dab7d2dc35b555928c1e20aad1981c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="test"/></a><div class="content"><a class="title" href="/2021/08/25/index/" title="test">test</a><time datetime="2021-08-25T15:36:11.000Z" title="Created 2021-08-25 15:36:11">2021-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/20/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84js/" title="ä½ ä¸äº†è§£çš„js"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Ffile01.dysucai.com%2Fd%2Ffile%2Flan2019010710%2Fibc3hrkwce1.jpg&amp;refer=http%3A%2F%2Ffile01.dysucai.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1632491575&amp;t=96e7f86935a561f8f50b380305881f79" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ä½ ä¸äº†è§£çš„js"/></a><div class="content"><a class="title" href="/2021/08/20/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84js/" title="ä½ ä¸äº†è§£çš„js">ä½ ä¸äº†è§£çš„js</a><time datetime="2021-08-20T00:00:00.000Z" title="Created 2021-08-20 00:00:00">2021-08-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: #0000006b"><div id="footer-wrap"><div class="copyright">&copy;2021 By xincheng</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<a href="http://beian.miit.gov.cn/"  target="_blank">èµ£ICPå¤‡2021007007å·</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>